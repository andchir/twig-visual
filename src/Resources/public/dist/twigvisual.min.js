!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./",n(n.s="QfWi")}({QfWi:function(t,e,n){(function(t){var e=n("eipz"),i=n("l7NG");t.twv_translations=e,t.TwigVisual=i}).call(this,n("yLpj"))},eipz:function(t,e){t.exports={ru:{Attribute:"Атрибут","Create new theme":"Создать новую тему","Create new template":"Создать шаблон","Interface item":"Элемент интерфейса","Undo the last action":"Отменить последнее действие","Execute batch of operations":"Выполнить пакет операций","Move left":"Передвинуть влево","Move right":"Передвинуть вправо",Apply:"Применить",Cancel:"Отменить","Clean content":"Очистить содержимое",'The "{title}" field is required.':'Поле "{title}" обязательно.',Insert:"Вставить","Insert before":"Вставить до","Insert after":"Вставить после",Selected:"Выбрано","Edit text content":"Редактировать контент","Edit link":"Редактировать ссылку","Edit attribute":"Редактировать атрибут","Replace image":"Заменить картинку","Delete element":"Удалить элемент","Move element":"Переместить элемент","Restore static":"Восстановить статичное содержимое","Interface item type":"Тип блока интерфейса",Save:"Сохранить","Add to operations list":"Добавить в список операций",URL:"Ссылка","Open in":"Открыть в","the current tab":"текущей вкладке","a new tab":"новой вкладке",Confirm:"Подтвердить",Create:"Создать","Are you sure you want to return the item to its original state?":"Вы уверены, что хотите вернуть исходное состояние элемента?","Theme name":"Название темы","HTML-file of the main page":"HTML-файл главной страницы","Template name":"Название шаблона","HTML-file":"HTML-файл","The selected item must have tag {tagName}.":"Выбранный элемент должен иметь тег {tagName}.","The selected item must have tag {tagName} or have a background image.":"Выбранный элемент должен иметь тег {tagName} или фоновую картинку.","Upload ZIP file":"Загрузить ZIP файл",Value:"Значение"}}},l7NG:function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=null,this.loading=!1,this.parentElement=null,this.dataKey="source",this.data={},this.actions=[],this.timer=null,this.components=[],this.options=Object.assign({templateName:"",templates:[],pageFields:[],uiOptions:{},locale:"en",urlGetCollections:"/admin/content_types",urlGetCollectionFields:"/admin/content_types/by_name/",urlCreateContent:"/admin/products/",urlSwitchTheme:"/admin/settings/switch_theme/"},e),this.translations=window.twv_translations||{},this.state="inactive",this.listenerOnMouseOver=this.onMouseOver.bind(this),this.listenerOnMouseOut=this.onMouseOut.bind(this),this.listenerOnMouseWheel=this.onMouseWheel.bind(this),this.listenerOnMouseClick=this.onSelectedElementClick.bind(this),this.currentElements=[],this.selectedElement=null,t.onReady(this.init.bind(this))}var e,n,i;return e=t,i=[{key:"onLoad",value:function(t){"complete"===document.readyState?t():window.addEventListener("load",t)}},{key:"onReady",value:function(t){"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t)}}],(n=[{key:"init",value:function(){var t=this;this.container=this.createContainer(),this.container.querySelector(".twv-button-start-select").addEventListener("click",(function(e){e.preventDefault(),e.target.setAttribute("disabled","disabled"),t.removeSelectionInner(),t.selectModeToggle(document.body,"source")})),this.container.querySelector(".twv-button-new-theme").addEventListener("click",(function(e){e.preventDefault(),"active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy(!0),t.addNewThemeInit()})),this.container.querySelector(".twv-button-new-template").addEventListener("click",(function(e){e.preventDefault(),"active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy(!0),t.addNewTemplateInit()})),document.body.addEventListener("keyup",(function(e){if("Escape"===e.code&&("active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy()),"Enter"===e.code&&"active"===t.state){var n=document.querySelector(".twv-selected");t.selectModeApply(n)}}));var e=this.getCookie("twv-panel-class-name");e&&(this.container.className=e,this.container.classList.add("twig-visual-container"))}},{key:"trans",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=this.translations[this.options.locale]&&this.translations[this.options.locale][t]||t,Object.keys(n).forEach((function(t){e=e.replace("{".concat(t,"}"),n[t])})),e}},{key:"selectModeToggle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"source",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t=t||this.parentElement,"inactive"===this.state)this.parentElement=t,this.dataKey=e,n&&(this.container.style.display="none"),t.addEventListener("mouseover",this.listenerOnMouseOver),t.addEventListener("mouseout",this.listenerOnMouseOut),t.addEventListener("wheel",this.listenerOnMouseWheel,{passive:!1}),t.addEventListener("click",this.listenerOnMouseClick),this.state="active";else{if(this.container.style.display="block",t.removeEventListener("mouseover",this.listenerOnMouseOver),t.removeEventListener("mouseout",this.listenerOnMouseOut),t.removeEventListener("wheel",this.listenerOnMouseWheel),t.removeEventListener("click",this.listenerOnMouseClick),this.container.querySelector(".twv-ui-components")){var i=this.container.querySelector(".twv-ui-components").querySelectorAll("button");Array.from(i).forEach((function(t){t.removeAttribute("disabled")}))}var a=this.container.querySelector(".twv-button-start-select");a.removeAttribute("disabled"),this.state="inactive",this.onAfterSelect()}}},{key:"onAfterSelect",value:function(){var t=this;switch(this.dataKey){case"moveTarget":var e=this.container.querySelector(".twv-inner"),n=this.container.querySelector(".twv-button-start-select");this.makeButtonSelected(n,!0,(function(){return t.selectionModeDestroy(!0),!0})),this.removeOverlay(),e.innerHTML="";var i=document.createElement("div");i.className="twv-pt-1 twv-mb-3",i.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="inside" checked="checked">\n                            '.concat(this.trans("Insert"),'\n                        </label>\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="before">\n                            ').concat(this.trans("Insert before"),'\n                        </label>\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="after">\n                            ').concat(this.trans("Insert after"),'\n                        </label>\n                    </div>\n                    <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                        <i class="twv-icon-done"></i>\n                        ').concat(this.trans("Apply"),'\n                    </button>\n                    <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                        <i class="twv-icon-clearclose"></i>\n                    </button>\n                '),e.appendChild(i);var a=e.querySelector(".twv-button-submit"),o=e.querySelector(".twv-button-cancel");a.addEventListener("click",(function(n){n.preventDefault();var i=e.querySelector('input[name="insertMode"]:checked').value;t.showLoading(!0),t.request("/twigvisual/move_element",{templateName:t.options.templateName,xpath:t.data.source.xpath,xpathTarget:t.data.moveTarget.xpath,insertMode:i},(function(e){e.success?t.windowReload():t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST")})),o.addEventListener("click",(function(n){n.preventDefault(),e.innerHTML="",t.selectionModeDestroy(!0)}))}}},{key:"onMouseOver",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(this.currentElements=[],this.updateXPathInfo(t.target),t.target.classList.add("twv-selected"),this.displayPadding(t.target))}},{key:"onMouseOut",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(this.currentElements=[],Array.from(document.querySelectorAll(".twv-selected")).forEach((function(t){t.classList.remove("twv-selected"),t.style.boxShadow=""})))}},{key:"onSelectedElementClick",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(t.preventDefault(),t.stopPropagation(),this.selectModeApply(t.target))}},{key:"selectModeApply",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:e;if(n){this.removeOverlay();var i=this.getXPathForElement(n);if(this.data[this.dataKey]={xpath:i,className:n.className},this.data[this.dataKey]){var a=this.data[this.dataKey].xpath;this.removeSelectionInnerByXPath(a)}if("active"===this.state&&this.selectModeToggle(),this.selectionModeDestroy(),"source"===this.dataKey)this.parentElement=n,this.createSelectionOptions(i);else{this.highlightElement(),n.classList.add("twv-selected-success");var o=this.components.findIndex((function(e){return e.name===t.dataKey}));o>-1&&(n.getAttribute("title")&&!n.dataset.twvTitle&&(n.dataset.twvTitle=n.getAttribute("title")),n.setAttribute("title",this.components[o].title)),this.componentButtonMakeSelected(this.dataKey)}}}},{key:"selectionModeDestroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];document.querySelector(".twv-info")&&this.removeEl(document.querySelector(".twv-info"));var n=Array.from(document.querySelectorAll(".twv-selected"));if(n.forEach((function(t){t.classList.remove("twv-selected"),t.style.boxShadow=""})),t){e&&(this.data={}),this.currentElements=[],this.components=[];var i=this.container.querySelector(".twv-button-start-select");i.parentNode.classList.remove("twv-block-active-status-active"),this.container.querySelector(".twv-inner").innerHTML="",this.removeOverlay();var a=document.querySelector(".twv-selected-element");a&&(a.contentEditable=!1,a.dataset.twvContent&&(a.innerHTML=a.dataset.twvContent,a.dataset.twvContent=""),a.classList.remove("twv-selected-element"),a.style.transform="",a.style.transition="",this.setToParents(a,{transform:"",transition:""})),this.removeSelectionInner()}}},{key:"onMouseWheel",value:function(t){if(!(this.getXPathForElement(t.target).indexOf("twig-visual-container")>-1)){t.preventDefault();var e=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:t.target;t.deltaY<0?(e.classList.remove("twv-selected"),e.style.boxShadow="",this.getPreviousSiblings(this.currentElements,e),this.currentElements.push(e.parentNode),this.updateXPathInfo(e.parentNode),e.parentNode.classList.add("twv-selected"),this.displayPadding(e.parentNode)):(e.classList.remove("twv-selected"),e.style.boxShadow="",this.currentElements.splice(this.currentElements.length-1,1),e=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:t.target,this.updateXPathInfo(e),e.classList.add("twv-selected"),this.displayPadding(e))}}},{key:"getPreviousSiblings",value:function(t,e){e.previousElementSibling&&(t.push(e.previousElementSibling),this.getPreviousSiblings(t,e.previousElementSibling))}},{key:"getNextSiblings",value:function(t,e){e.nextElementSibling&&(t.push(e.nextElementSibling),this.getPreviousSiblings(t,e.nextElementSibling))}},{key:"removeSelectionInner",value:function(){Array.from(document.querySelectorAll(".twv-selected-success")).forEach((function(t){t.dataset.twvTitle&&t.setAttribute("title",t.dataset.twvTitle),t.classList.remove("twv-selected-success")}))}},{key:"removeSelectionInnerByXPath",value:function(t){this.removeOverlay();var e=this.getElementByXPath(t);return!!e&&(this.highlightElement(),e.dataset.twvTitle&&e.setAttribute("title",e.dataset.twvTitle),e.classList.remove("twv-selected-success"),!0)}},{key:"highlightElement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twv-selected-element";if(t||(t=this.parentElement),t&&"BODY"!==t.tagName&&!document.querySelector(".twv-back-overlay")){t.classList.add(e);var n=window.getComputedStyle(t),i=n.getPropertyValue("position"),a=n.getPropertyValue("background-color");"static"===i&&(t.style.position="relative"),["rgba(0, 0, 0, 0)","transparent"].indexOf(a),t.style.transform="none",t.style.transition="none",this.setToParents(t,{transform:"none",transition:"none"});var o=document.createElement("LI"===t.tagName?"li":"div");o.className="twv-back-overlay",this.insertBefore(o,t)}}},{key:"removeOverlay",value:function(){document.querySelector(".twv-back-overlay")&&this.removeEl(document.querySelector(".twv-back-overlay"))}},{key:"updateXPathInfo",value:function(t){var e=this.getXPathForElement(t,!0);if(!(e.indexOf("twig-visual-container")>-1)){var n=document.querySelector(".twv-info");n||((n=document.createElement("div")).className="twv-info small",document.body.appendChild(n)),n.style.display="block",n.innerHTML="<div>".concat(e,"</div>")}}},{key:"getXPathForElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(""!==t.id)return'id("'+t.id+'")';if("HTML"===t.tagName)return"/HTML[1]".toLowerCase();if(t===document.body)return"/HTML[1]/BODY[1]".toLowerCase();if(!t.parentNode)return"";for(var n=0,i=t.parentNode.childNodes,a=0;a<i.length;a++){var o=i[a];if(o===t)return this.getXPathForElement(t.parentNode,e)+"/"+t.tagName.toLowerCase()+"["+(n+1)+"]"+(e?this.getXpathElementAttributes(t):"");o.nodeType===Node.ELEMENT_NODE&&o.tagName===t.tagName&&n++}}},{key:"getXpathElementAttributes",value:function(t){return t.hasAttribute("id")?'id("'.concat(t.id,'")'):t.hasAttribute("class")&&t.getAttribute("class")?'[@class="'.concat(t.getAttribute("class"),'"]'):""}},{key:"getElementByXPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.document,n=document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return n.singleNodeValue}},{key:"createContainer",value:function(){var t=this,e=document.createElement("div");return e.id="twig-visual-container",e.className="twig-visual-container twv-panel-right",e.innerHTML='\n        <div class="twv-panel-header">\n            <div class="twv-panel-header-buttons">\n                <button class="twv-btn twv-btn-sm twv-button-undo" type="button" title="'.concat(this.trans("Undo the last action"),'">\n                    <i class="twv-icon-undo"></i>\n                </button>\n                <button class="twv-btn twv-btn-sm twv-ml-1 twv-button-execute-batch" type="button" title="').concat(this.trans("Execute batch of operations"),'" style="display: none;">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                    <span></span>\n                </button>\n            </div>\n            <button class="twv-btn twv-btn-sm twv-mr-1 twv-button-panel-left" type="button" title="').concat(this.trans("Move left"),'">\n                <i class="twv-icon-arrow_back"></i>\n            </button>\n            <button class="twv-btn twv-btn-sm twv-button-panel-right" type="button" title="').concat(this.trans("Move right"),'">\n                <i class="twv-icon-arrow_forward"></i>\n            </button>\n        </div>\n        <div class="twv-px-3 twv-mb-2">\n            <button type="button" class="twv-btn twv-btn-block twv-button-new-theme">\n                <i class="twv-icon-add"></i>\n                ').concat(this.trans("Create new theme"),'\n            </button>\n        </div>\n        <div class="twv-px-3 twv-mb-2">\n            <button type="button" class="twv-btn twv-btn-block twv-button-new-template">\n                <i class="twv-icon-add"></i>\n                ').concat(this.trans("Create new template"),'\n            </button>\n        </div>\n        <div class="twv-px-3 twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-btn-block twv-button-start-select">\n                <i class="twv-icon-center_focus_strong"></i>\n                ').concat(this.trans("Interface item"),'\n            </button>\n        </div>\n        <div class="twv-inner-wrapper">\n            <div class="twv-px-3 twv-inner"></div>\n        </div>\n        '),document.body.appendChild(e),e.querySelector(".twv-button-panel-left").addEventListener("click",(function(e){e.preventDefault(),t.panelMove("left")})),e.querySelector(".twv-button-panel-right").addEventListener("click",(function(e){e.preventDefault(),t.panelMove("right")})),e.querySelector(".twv-button-execute-batch").addEventListener("click",(function(e){e.preventDefault(),t.executeActionBatch()})),e.querySelector(".twv-button-undo").addEventListener("click",(function(e){e.preventDefault(),t.restoreFromTemplateCopyA()})),e}},{key:"panelMove",value:function(t){var e="twv-panel-".concat(t);return this.container.classList.contains(e)?(this.container.classList.add("twv-panel-hidden"),void this.setCookie("twv-panel-class-name",this.container.className)):this.container.classList.contains("twv-panel-hidden")?(this.container.classList.remove("twv-panel-hidden"),void this.setCookie("twv-panel-class-name",this.container.className)):(this.container.classList.remove("twv-panel-"+("left"===t?"right":"left")),this.container.classList.add(e),void this.setCookie("twv-panel-class-name",this.container.className))}},{key:"onBlockUiTypeChange",value:function(t,e){var n=this,i=this.container.querySelector(".twv-ui-components");if(i.innerHTML="",this.removeSelectionInner(),e&&this.options.uiOptions[e]){Object.keys(this.data).forEach((function(t){"source"!==t&&delete n.data[t]}));var a=this.options.uiOptions[e];this.components=a.components,this.createComponentsControls(i);var o=document.createElement("div");o.className="twv-pt-1 twv-mb-3",o.innerHTML='\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                <i class="twv-icon-done"></i>\n                '.concat(this.trans("Apply"),'\n            </button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                <i class="twv-icon-clearclose"></i>\n            </button>\n        '),i.appendChild(o);var s=this.container.querySelector(".twv-button-submit"),l=this.container.querySelector(".twv-button-cancel");s.addEventListener("click",(function(t){t.preventDefault();var o={templateName:n.options.templateName,data:n.data};if(Array.from(i.querySelectorAll('input[type="text"]')).forEach((function(t){o.data[t.name]=t.value})),Array.from(i.querySelectorAll('input[type="number"]')).forEach((function(t){o.data[t.name]=t.value})),Array.from(i.querySelectorAll("select")).forEach((function(t){o.data[t.name]=t.value})),Array.from(i.querySelectorAll('input[type="checkbox"]')).forEach((function(t){o.data[t.name]=t.checked})),Array.from(i.querySelectorAll('input[type="radio"]:checked')).forEach((function(t){o.data[t.name]=t.value})),n.checkRequired(o.data,n.components)){var c=a.isInsertMode?"/twigvisual/move_element/".concat(e):"/twigvisual/create_component/".concat(e);s.setAttribute("disabled","disabled"),l.setAttribute("disabled","disabled"),n.showLoading(!0);var r=function(t){n.request(c,t,(function(t){t.success?n.windowReload():(s.removeAttribute("disabled"),l.removeAttribute("disabled"),n.showLoading(!1))}),(function(t){n.addAlertMessage(t.error||t),s.removeAttribute("disabled"),l.removeAttribute("disabled"),n.showLoading(!1)}),"POST")};"includeContent"===e&&!o.data.contentId&&o.data.contentTitle&&o.data.parentId?n.createPage(o.data.parentId,o.data.contentTitle,o,(function(t){t.success?(o.data.contentId=t.result._id||t.result.id,r(o)):(t.error&&n.addAlertMessage(t.error),s.removeAttribute("disabled"),l.removeAttribute("disabled"),n.showLoading(!1))})):r(o)}})),l.addEventListener("click",(function(t){t.preventDefault();var e=n.container.querySelector(".twv-ui-element-select > select"),i=document.querySelector(".twv-selected-element");document.querySelector(".twv-info")&&n.removeEl(document.querySelector(".twv-info")),"active"!==n.state?e.value?(e.value="",n.selectionModeDestroy(),n.onBlockUiTypeChange(i)):n.selectionModeDestroy(!0):n.selectModeToggle()}))}}},{key:"createPage",value:function(t,e,n,i){var a=this,o=this.options.urlCreateContent+t,s=this.components.findIndex((function(t){return"dbCollectionFieldsLIst"===t.type}));if(-1!==s){var l=this.components[s].name,c={parentId:t,title:e,name:e.trim().toLowerCase().replace(/\s/g,"-").substring(0,25),isActive:!0,clearCache:!0};this.removeOverlay(),Object.keys(n.data).forEach((function(t){if(0===t.indexOf(l)){var e=n.data[t].xpath,i=t.split("_"),o=a.getElementByXPath(e);if(!o||"title"===i[1])return;c[i[1]]=o.innerHTML}})),this.highlightElement(),this.request(o,c,(function(t){"function"==typeof i&&i({success:!0,result:t})}),(function(t){"function"==typeof i&&i({success:!1,error:t.error||""})}),"POST")}else"function"==typeof i&&i({success:!1})}},{key:"createComponentsControls",value:function(t){var e,n=this,i=document.createElement("div");i.className="twv-pt-1 twv-mb-3",this.components.forEach((function(a){var o=document.createElement("div");switch(o.className="",a.type){case"elementSelect":o.innerHTML='<div class="twv-mb-2">\n                        <button data-twv-key="'.concat(a.name,'" class="twv-btn twv-btn-block twv-text-overflow">').concat(a.title,"</button>\n                    </div>\n                    "),o.querySelector("button").addEventListener("click",(function(t){t.preventDefault(),"active"!==n.state&&(t.target.setAttribute("disabled","disabled"),n.selectModeToggle(n.parentElement,a.name,!1))})),i.appendChild(o);break;case"text":case"number":var s=a.value||"";if(a.styleName){var l=window.getComputedStyle(n.parentElement);l[a.styleName]&&(s=s?s+" "+l[a.styleName]:l[a.styleName])}if(!s&&"contentTitle"===a.name){var c=n.parentElement.querySelectorAll("h1,h2,h3,h4,h5,h6");s=c.length>0?c[0].innerText:""}o.innerHTML='\n                    <div class="twv-mb-2">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(a.name,'">').concat(a.title,'</label>\n                        <input type="').concat(a.type,'" id="tww-field-option-').concat(a.name,'" class="twv-form-control" name="').concat(a.name,'" value="').concat(s,'">\n                    </div>\n                    '),i.appendChild(o);break;case"checkbox":o.innerHTML='\n                    <div class="twv-mb-2">\n                        <input type="checkbox" id="tww-field-option-'.concat(a.name,'" name="').concat(a.name,'" value="1">\n                        <label class="twv-display-inline twv-small twv-ml-1" for="tww-field-option-').concat(a.name,'">').concat(a.title,"</label>\n                    </div>\n                    "),i.appendChild(o);break;case"radio":var r="";a.title&&(r+='<div class="twv-mb-2">'.concat(a.title,"</div>")),a.options&&a.options.forEach((function(t,e){r+='\n                            <label class="twv-display-block">\n                                <input type="radio" name="'.concat(a.name,'" value="').concat(t.value,'">\n                                ').concat(n.trans(t.title),"\n                             </label>\n                            ")})),o.innerHTML=r,o.className="twv-mb-3",i.appendChild(o),o.querySelector("input").checked=!0;break;case"pageField":e="",n.options.pageFields.forEach((function(t){e+='<option value="'.concat(t.name,'" data-type="').concat(t.type,'">').concat(t.name," - ").concat(t.type,"</option>")})),o.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(a.name,'">').concat(a.title,'</label>\n                        <select id="tww-field-option-').concat(a.type,'" class="twv-custom-select" name="fieldName">\n                            ').concat(e,"\n                        </select>\n                    </div>\n                    "),i.appendChild(o);var u=function(e,n){var i=t.querySelector('input[name="key"]');i&&(i.parentNode.style.display=["object","array"].indexOf(n)>-1?"block":"none",-1===["object","array"].indexOf(n)&&(i.value=""))};o.querySelector("select").addEventListener("change",(function(t){var e=t.target,n=e.options[e.selectedIndex];u(e.value,n.dataset.type)})),setTimeout((function(){u(o.querySelector("select").value,o.querySelector("select").querySelector("option").dataset.type)}),1);break;case"include":e="",n.showLoading(!0),n.request("/twigvisual/includes",{},(function(t){t.templates&&(t.templates.forEach((function(t){e+='<option value="'.concat(t,'">').concat(t,"</option>")})),o.querySelector("select").innerHTML=e),n.showLoading(!1)}),(function(t){n.addAlertMessage(t.error||t),n.showLoading(!1)})),o.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(a.name,'">').concat(a.title,'</label>\n                        <select id="tww-field-option-').concat(a.name,'" class="twv-custom-select" name="').concat(a.name,'">\n                            ').concat(e,"\n                        </select>\n                    </div>\n                    "),i.appendChild(o);break;case"dbCollectionName":e="",n.showLoading(!0),n.request(n.options.urlGetCollections,{},(function(t){t.items&&(t.items.forEach((function(t){e+='<option value="'.concat(t.name,'">').concat(t.title,"</option>")})),o.querySelector("select").innerHTML=e),n.updateCollectionFieldsList(o.querySelector("select").value)}),(function(t){n.addAlertMessage(t.error||t),n.showLoading(!1)})),o.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(a.name,'">').concat(a.title,'</label>\n                        <select id="tww-field-option-').concat(a.name,'" class="twv-custom-select" name="').concat(a.name,'">\n                            ').concat(e,"\n                        </select>\n                    </div>\n                    "),i.appendChild(o),o.querySelector("select").addEventListener("change",(function(){n.showLoading(!0),n.updateCollectionFieldsList(o.querySelector("select").value)}));break;case"dbCollectionField":e="",o.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(a.name,'">').concat(a.title,'</label>\n                        <select id="tww-field-option-').concat(a.type,'" class="twv-custom-select" name="').concat(a.name,'">\n                            ').concat(e,"\n                        </select>\n                    </div>\n                    "),i.appendChild(o);break;case"dbCollectionFieldsLIst":o.innerHTML='<div class="twv-mb-3" id="tww-field-option-'.concat(a.type,'" data-name="').concat(a.name,'"></div>'),i.appendChild(o)}})),t.appendChild(i)}},{key:"updateCollectionFieldsButtonsList",value:function(t,e){var n=this,i=t.dataset.name||"child_item";t.innerHTML="",e.forEach((function(e){var a=document.createElement("div");a.innerHTML='<div class="twv-mb-2">\n                <button data-twv-key="'.concat(i,"_").concat(e.name,'" class="twv-btn twv-btn-block twv-text-overflow">').concat(e.title,"</button>\n            </div>\n            "),a.querySelector("button").addEventListener("click",(function(t){t.preventDefault(),"active"!==n.state&&(t.target.setAttribute("disabled","disabled"),n.selectModeToggle(n.parentElement,"".concat(i,"_").concat(e.name),!1))})),t.appendChild(a)}))}},{key:"updateCollectionFieldsList",value:function(t){var e=this,n=document.getElementById("tww-field-option-dbCollectionFieldsLIst"),i=document.getElementById("tww-field-option-dbCollectionField");this.request(this.options.urlGetCollectionFields+t,{},(function(t){if(n&&e.updateCollectionFieldsButtonsList(n,t.fields),i){if(i.innerHTML="",t.fields){var a="",o="";t.fields.forEach((function(t){a+='<option value="'.concat(t.name,'">').concat(t.title,"</option>"),["description","content"].indexOf(t.name)>-1&&(o=t.name)})),i.innerHTML=a,i.value=o||t.fields[0].name}e.showLoading(!1)}else e.showLoading(!1)}))}},{key:"checkRequired",value:function(t,e){var n=!0,i=!0,a=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if(c.required&&!t[c.name]){n=!1,alert(this.trans('The "{title}" field is required.',{title:c.title}));break}}}catch(t){a=!0,o=t}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}return n}},{key:"componentButtonMakeSelected",value:function(t){var e=this,n=this.container.querySelector(".twv-ui-components");if(n){var i=Array.from(n.querySelectorAll("button"));1===(i=i.filter((function(e){return e.dataset.twvKey===t}))).length&&this.makeButtonSelected(i[0],!0,(function(){var n=e.data[t]?e.data[t].xpath:null;return!!e.removeSelectionInnerByXPath(n)&&(delete e.data[t],!0)}))}}},{key:"makeButtonSelected",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t.removeAttribute("disabled"),t.parentNode.classList.contains("twv-block-active-status"))n?t.parentNode.classList.add("twv-block-active-status-active"):t.parentNode.classList.remove("twv-block-active-status-active");else{var a=t.textContent.trim(),o=document.createElement("div");o.innerHTML='\n        <div class="twv-block-active-status twv-block-active-status-active">\n            <div class="twv-block-active-status-active-content">\n                <div class="twv-input-group">\n                    <span class="twv-input-group-text twv-flex-fill" title="'.concat(a,'">\n                        <i class="twv-icon-done twv-mr-2 twv-text-success"></i>\n                        ').concat(this.trans("Selected"),'\n                    </span>\n                    <div class="twv-input-group-append">\n                        <button class="twv-btn twv-block-active-status-button-cancel" title="').concat(this.trans("Cancel"),'">\n                            <i class="twv-icon-clearclose"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        '),t.classList.add("twv-block-active-status-inactive-content"),this.insertAfter(o,t),o.querySelector(".twv-block-active-status").appendChild(t),t.parentNode.querySelector(".twv-block-active-status-button-cancel").addEventListener("click",(function(n){n.preventDefault(),"function"==typeof i?i()&&e.makeButtonSelected(t,!1):e.makeButtonSelected(t,!1)}))}}},{key:"createSelectionOptions",value:function(t){var e=this,n=this.getElementByXPath(t);if(!n)throw new Error("Element for XPath not found.");var i=this.container.querySelector(".twv-button-start-select");this.makeButtonSelected(i,!0,(function(){return e.selectionModeDestroy(!0),!0})),this.container.querySelector(".twv-inner").innerHTML="";var a="";Object.keys(this.options.uiOptions).forEach((function(t){a+='<option value="'.concat(t,'">').concat(e.options.uiOptions[t].title,"</option>")}));var o=t.replace(/[\"]/g,"&quot;"),s=document.createElement("div");s.innerHTML='\n        <b>XPath:</b>\n        <div class="twv-p-1 twv-mb-3 twv-small twv-bg-gray">\n            <div class="twv-text-overflow" title="'.concat(o,'">').concat(t,'</div>\n        </div>\n        <div class="twv-mb-3 twv-nowrap">\n            <button type="button" class="twv-btn twv-mr-1 twv-button-edit-text" title="').concat(this.trans("Edit text content"),'">\n                <i class="twv-icon-createmode_editedit"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-edit-attribute" title="').concat(this.trans("Edit attribute"),'">\n                <i class="twv-icon-linkinsert_link"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-replace-image" title="').concat(this.trans("Replace image"),'">\n                <i class="twv-icon-insert_photoimagephoto"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-delete-element" title="').concat(this.trans("Delete element"),'">\n                <i class="twv-icon-delete_outline"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-move-element" title="').concat(this.trans("Move element"),'">\n                <i class="twv-icon-move"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-restore-static" title="').concat(this.trans("Restore static"),'">\n                <i class="twv-icon-cached"></i>\n            </button>\n        </div>\n        <div class="twv-mb-3 twv-ui-element-select">\n            <select class="twv-custom-select">\n                <option value="">- ').concat(this.trans("Interface item type")," -</option>\n                ").concat(a,'\n            </select>\n        </div>\n        <hr class="twv-hr">\n        <div class="twv-mb-3 twv-ui-components"></div>\n        '),this.container.querySelector(".twv-inner").appendChild(s),this.container.querySelector(".twv-ui-element-select > select").addEventListener("change",(function(t){e.onBlockUiTypeChange(n,t.target.value)})),this.container.querySelector(".twv-button-edit-text").addEventListener("click",(function(t){t.preventDefault(),e.editTextContentInit(n)})),this.container.querySelector(".twv-button-edit-attribute").addEventListener("click",(function(t){t.preventDefault(),e.editAttributeInit(n)})),this.container.querySelector(".twv-button-replace-image").addEventListener("click",(function(t){t.preventDefault(),e.replaceImageInit(n)})),this.container.querySelector(".twv-button-delete-element").addEventListener("click",(function(t){t.preventDefault(),e.deleteElementInit(n)})),this.container.querySelector(".twv-button-move-element").addEventListener("click",(function(t){t.preventDefault(),t.target.setAttribute("disabled","disabled"),e.moveElementInit()})),this.container.querySelector(".twv-button-restore-static").addEventListener("click",(function(t){t.preventDefault(),e.restoreStaticInit()})),this.highlightElement(n,"twv-selected-element")}},{key:"editTextContentInit",value:function(t){var e=this;this.clearMessage();var n=this.container.querySelector(".twv-ui-components"),i=t.innerHTML;n.innerHTML="";var a=document.createElement("div");a.innerHTML='\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    '.concat(this.trans("Save"),'\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="').concat(this.trans("Add to operations list"),'">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),n.appendChild(a),t.dataset.twvContent=i,t.contentEditable=!0,t.focus();var o=this.container.querySelector(".twv-button-submit"),s=this.container.querySelector(".twv-button-cancel");o.addEventListener("click",(function(n){n.preventDefault(),t.contentEditable=!1,o.setAttribute("disabled","disabled"),s.setAttribute("disabled","disabled"),e.showLoading(!0),e.request("/twigvisual/edit_content",{templateName:e.options.templateName,xpath:e.data.source.xpath,textContent:t.innerHTML},(function(t){t.success?e.windowReload():(o.removeAttribute("disabled"),s.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),o.removeAttribute("disabled"),s.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(n){n.preventDefault(),e.addToActionBatch("edit_content",e.data.source.xpath,{value:t.innerHTML})})),s.addEventListener("click",(function(e){e.preventDefault(),t.contentEditable=!1,n.innerHTML="",t.innerHTML=i}))}},{key:"editAttributeInit",value:function(t){var e=this;this.clearMessage();var n=this.container.querySelector(".twv-ui-components"),i=t.getAttribute("href")||"",a=t.getAttribute("target")||"_self";n.innerHTML="";var o=document.createElement("div");o.innerHTML='\n            <div class="twv-mb-3">\n                <label class="twv-display-block twv-mb-1" for="tww-field-element-attr-name">'.concat(this.trans("Attribute"),'</label>\n                <select id="tww-field-element-attr-name" class="twv-custom-select">\n                    <option value="href">Href</option>\n                    <option value="title">Title</option>\n                    <option value="class">Class</option>\n                </select>\n            </div>\n            <div class="twv-mb-3">\n                <label class="twv-display-block twv-mb-1" for="tww-field-element-attr-value">').concat(this.trans("Value"),'</label>\n                <input type="text" id="tww-field-element-attr-value" class="twv-form-control" value="').concat(i,'">\n            </div>\n            <div class="twv-mb-3">\n                <label class="twv-display-block twv-mb-1" for="tww-field-element-link">').concat(this.trans("Open in"),'</label>\n                <select id="tww-field-link-target" class="twv-custom-select">\n                    <option value="_self"').concat("_blank"!=a?' selected="selected"':"",">").concat(this.trans("the current tab"),'</option>\n                    <option value="_blank"').concat("_blank"==a?' selected="selected"':"",">").concat(this.trans("a new tab"),'</option>\n                </select>\n            </div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    ').concat(this.trans("Save"),'\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="').concat(this.trans("Add to operations list"),'">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),n.appendChild(o);var s=this.container.querySelector(".twv-button-submit"),l=this.container.querySelector(".twv-button-cancel"),c=document.getElementById("tww-field-element-attr-name"),r=document.getElementById("tww-field-element-attr-value");s.addEventListener("click",(function(n){n.preventDefault();var i=c.value,a=r.value;"href"!==i||"a"===t.tagName.toLowerCase()?(e.showLoading(!0),e.request("/twigvisual/edit_attribute",{templateName:e.options.templateName,xpath:e.data.source.xpath,attribute:i,value:a,target:o.querySelector("#tww-field-link-target").value},(function(t){t.success?e.windowReload():(s.removeAttribute("disabled"),l.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),s.removeAttribute("disabled"),l.removeAttribute("disabled"),e.showLoading(!1)}),"POST")):alert(e.trans("The selected item must have tag {tagName}.",{tagName:"A"}))})),document.getElementById("tww-field-element-attr-name").addEventListener("change",(function(e){!function(e){var n,i=document.getElementById("tww-field-element-attr-value");"title"===e&&!t.getAttribute("title")&&t.dataset.twvTitle?n=t.dataset.twvTitle:(n=t.getAttribute(e),"class"===e&&(n=n.replace("twv-selected-element","").trim())),document.getElementById("tww-field-link-target").parentNode.style.display="href"===e?"block":"none",i.value=n||""}(e.target.value)})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(t){t.preventDefault(),e.addToActionBatch("edit_link",e.data.source.xpath,{href:o.querySelector('input[type="text"]').value,target:o.querySelector("select").value})})),l.addEventListener("click",(function(e){e.preventDefault(),t.contentEditable=!1,n.innerHTML="",t.setAttribute("href",i)}))}},{key:"replaceImageInit",value:function(t){var e=this,n="",i="src";if("img"!==t.tagName.toLowerCase()){var a=window.getComputedStyle(t);if("none"===a["background-image"])return void alert(this.trans("The selected item must have tag {tagName} or have a background image.",{tagName:"IMG"}));var o=a["background-image"].match(/url\(\"([^\"]+)\"\)/);n=o?o[1]:"",i="style"}else n=t.getAttribute("src");this.clearMessage();var s=this.container.querySelector(".twv-ui-components");s.innerHTML="";var l=document.createElement("div");l.innerHTML='\n            <div class="twv-mb-3 twv-text-center"><img class="twv-image-preview" style="max-width: 80%;"></div>\n            <input type="file" style="display: none;" name="image_file">\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    '.concat(this.trans("Save"),'\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),s.appendChild(l);var c=this.container.querySelector(".twv-button-submit"),r=this.container.querySelector(".twv-button-cancel"),u=this.container.querySelector('input[type="file"]'),d=this.container.querySelector(".twv-image-preview");d.setAttribute("src",n),c.addEventListener("click",(function(t){t.preventDefault();var n=new FormData;n.append("templateName",e.options.templateName),n.append("xpath",e.data.source.xpath),n.append("imageFile",u.files[0]),n.append("attributeName",i),e.showLoading(!0),e.request("/twigvisual/replace_image",n,(function(t){t.success?e.windowReload():(c.removeAttribute("disabled"),r.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),c.removeAttribute("disabled"),r.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),r.addEventListener("click",(function(e){e.preventDefault(),t.contentEditable=!1,s.innerHTML=""})),u.addEventListener("change",(function(t){!function(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(t){d.setAttribute("src",t.target.result)},e.readAsDataURL(t.files[0])}}(t.target)})),u.click(),d.addEventListener("click",(function(t){t.preventDefault(),u.click()}))}},{key:"deleteElementInit",value:function(t){var e=this;this.clearMessage();var n=this.container.querySelector(".twv-ui-components");t.textContent.trim(),n.innerHTML="";var i=document.createElement("div");i.innerHTML='\n            <div class="twv-mb-2">Вы уверены, что хотите удалить выбранный элемент?</div>\n            <div class="twv-mb-3">\n                <input type="checkbox" id="tww-field-clean" name="clean" value="1">\n                <label class="twv-display-inline twv-small twv-ml-1" for="tww-field-clean">'.concat(this.trans("Clean content"),'</label>\n            </div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    ').concat(this.trans("Confirm"),'\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="').concat(this.trans("Add to operations list"),'">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),n.appendChild(i);var a=this.container.querySelector(".twv-button-submit"),o=this.container.querySelector(".twv-button-cancel");a.addEventListener("click",(function(t){t.preventDefault(),e.showLoading(!0),e.request("/twigvisual/delete_element",{templateName:e.options.templateName,xpath:e.data.source.xpath,clean:e.container.querySelector('input[name="clean"]').checked},(function(t){t.success?e.windowReload():(a.removeAttribute("disabled"),o.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),a.removeAttribute("disabled"),o.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),o.addEventListener("click",(function(t){t.preventDefault(),n.innerHTML=""})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(t){t.preventDefault(),e.addToActionBatch("delete",e.data.source.xpath)}))}},{key:"moveElementInit",value:function(){var t=this;this.container.querySelector(".twv-ui-components").innerHTML="",this.selectionModeDestroy(!0,!1),setTimeout((function(){t.selectModeToggle(document.body,"moveTarget")}),1)}},{key:"restoreStaticInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-ui-components");e.innerHTML="";var n=document.createElement("div");n.innerHTML='\n            <div class="twv-mb-3">'.concat(this.trans("Are you sure you want to return the item to its original state?"),'</div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    ').concat(this.trans("Confirm"),'\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="').concat(this.trans("Cancel"),'">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),e.appendChild(n);var i=e.querySelector(".twv-button-submit"),a=e.querySelector(".twv-button-cancel");i.addEventListener("click",(function(e){e.preventDefault(),t.showLoading(!0),t.request("/twigvisual/restore_static",{templateName:t.options.templateName,xpath:t.data.source.xpath},(function(e){e.success?t.windowReload():(i.removeAttribute("disabled"),a.removeAttribute("disabled"),t.showLoading(!1))}),(function(e){t.addAlertMessage(e.error||e),i.removeAttribute("disabled"),a.removeAttribute("disabled"),t.showLoading(!1)}),"POST")})),a.addEventListener("click",(function(n){n.preventDefault(),t.clearMessage(),e.innerHTML=""}))}},{key:"addNewThemeInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-inner");e.innerHTML="";var n=document.createElement("div");n.innerHTML='\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-theme-name">'.concat(this.trans("Theme name"),'</label>\n            <input type="text" id="tww-field-theme-name" class="twv-form-control">\n        </div>\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-theme-mainpage">').concat(this.trans("HTML-file of the main page"),'</label>\n            <input type="text" id="tww-field-theme-mainpage" class="twv-form-control" value="index.html">\n        </div>\n        <div class="twv-mb-3">\n            <label class="twv-btn twv-btn-secondary twv-btn-block twv-button-upload">\n                <input type="file" accept=".zip" class="twv-display-none" name="file">\n                <i class="twv-icon-file_upload"></i>\n                ').concat(this.trans("Upload ZIP file"),'\n            </label>\n        </div>\n        <div class="twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">').concat(this.trans("Create"),'</button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel">').concat(this.trans("Cancel"),"</button>\n        </div>\n        "),e.appendChild(n),e.querySelector("button.twv-button-submit").addEventListener("click",(function(e){e.preventDefault();var n=document.getElementById("tww-field-theme-name"),i=document.getElementById("tww-field-theme-mainpage"),a=e.target;n.value&&i.value&&(t.clearMessage(),t.showLoading(!0),a.setAttribute("disabled","disabled"),t.request("/twigvisual/create",{theme:n.value,mainpage:i.value},(function(e){t.switchTheme(n.value)}),(function(e){t.addAlertMessage(e.error||e),a.removeAttribute("disabled"),t.showLoading(!1)}),"POST"))})),e.querySelector("button.twv-button-cancel").addEventListener("click",(function(t){t.preventDefault(),e.innerHTML=""})),e.querySelector(".twv-button-upload > input").addEventListener("change",(function(n){var i=document.getElementById("tww-field-theme-mainpage"),a=(e.querySelector(".twv-button-upload"),n.target.files);if(!a||0!==a.length){var o=new FormData;o.append("file",a[0]),o.append("mainpage",i.value),t.showLoading(!0),t.request("/twigvisual/upload_theme",o,(function(e){e.success?t.switchTheme(e.result):t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST")}}))}},{key:"addNewTemplateInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-inner");e.innerHTML="";var n="";this.options.templates.forEach((function(t){n+='<option value="'.concat(t,'">').concat(t,"</option>")})),this.showLoading(!0),this.request("/twigvisual/html_files",{},(function(e){if(e.files){var n="";e.files.forEach((function(t){n+='<option value="'.concat(t,'">').concat(t,"</option>")})),document.getElementById("tww-field-source-file").innerHTML=n}t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}));var i=document.createElement("div");i.innerHTML='\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-source-file">'.concat(this.trans("HTML-file"),'</label>\n            <select id="tww-field-source-file" class="twv-custom-select"></select>\n        </div>\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-template-name">').concat(this.trans("Template name"),'</label>\n            <select id="tww-field-template-name" class="twv-custom-select">\n                ').concat(n,'\n            </select>\n        </div>\n        <div class="twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">').concat(this.trans("Create"),'</button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel">').concat(this.trans("Cancel"),"</button>\n        </div>\n        "),e.appendChild(i),e.querySelector("button.twv-button-submit").addEventListener("click",(function(n){n.preventDefault();var i=document.getElementById("tww-field-source-file"),a=document.getElementById("tww-field-template-name"),o=n.target;i.value&&a.value&&(t.showLoading(!0),o.setAttribute("disabled","disabled"),t.request("/twigvisual/create_template",{fileName:i.value,templateName:a.value},(function(n){o.removeAttribute("disabled"),t.showLoading(!1),e.innerHTML="",n.message&&t.addAlertMessage(n.message,"success")}),(function(e){t.addAlertMessage(e.error||e),o.removeAttribute("disabled"),t.showLoading(!1)}),"POST"))})),e.querySelector("button.twv-button-cancel").addEventListener("click",(function(t){t.preventDefault(),e.innerHTML=""}))}},{key:"switchTheme",value:function(t){var e=this;this.showLoading(!0),this.request("".concat(this.options.urlSwitchTheme).concat(t),{themeName:t},(function(t){e.windowReload()}),(function(t){e.addAlertMessage(t.error||t),e.showLoading(!1)}),"POST")}},{key:"addToActionBatch",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.actions.push({action:t,xpath:e,options:i}),this.selectionModeDestroy(!0);var a=this.container.querySelector(".twv-button-execute-batch");a.querySelector("span").textContent="".concat(this.actions.length),a.style.display="inline-block",this.actions.forEach((function(t){var e=n.getElementByXPath(t.xpath);e&&e.classList.add("twv-selected-success")}))}},{key:"executeActionBatch",value:function(){var t=this;0!==this.actions.length&&(this.showLoading(!0),this.request("/twigvisual/batch",{templateName:this.options.templateName,actions:this.actions},(function(e){e.success&&t.windowReload(),t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST"))}},{key:"restoreFromTemplateCopyA",value:function(){var t=this;this.showLoading(!0),this.request("/twigvisual/restore_backup",{templateName:this.options.templateName},(function(e){e.success&&t.windowReload(),t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST")}},{key:"showLoading",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=t,t?this.container.classList.add("twv-loading"):this.container.classList.remove("twv-loading")}},{key:"addAlertMessage",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"danger";clearTimeout(this.timer);var i=this.container.querySelector(".twv-inner");i.querySelector(".twv-alert")&&this.removeEl(i.querySelector(".twv-alert"));var a=document.createElement("div");a.innerHTML='\n        <div class="twv-alert twv-alert-'.concat(n,'">').concat(t,"</div>\n        "),i.appendChild(a),i.scrollTop=i.scrollHeight,a.addEventListener("mouseenter",(function(){clearTimeout(e.timer)})),a.addEventListener("mouseleave",(function(){e.timer=setTimeout(e.clearMessage.bind(e),4e3)})),this.timer=setTimeout(this.clearMessage.bind(this),4e3)}},{key:"clearMessage",value:function(){var t=this.container.querySelector(".twv-inner");t.querySelector(".twv-alert")&&this.removeEl(t.querySelector(".twv-alert"))}},{key:"displayPadding",value:function(t){var e=window.getComputedStyle(t),n="0 0 0 2px #007bff";"0px"!==e["padding-top"]&&(n+=", inset 0 ".concat(e["padding-top"]," 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-bottom"]&&(n+=", inset 0 -".concat(e["padding-bottom"]," 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-left"]&&(n+=", inset ".concat(e["padding-left"]," 0 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-right"]&&(n+=", inset -".concat(e["padding-right"]," 0 0 0 rgba(50,168,82,0.15)")),n&&(t.style.boxShadow=n)}},{key:"request",value:function(t,e,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"GET",o=new XMLHttpRequest;o.open(a,t,!0),o.onload=function(){var t=["{","["].indexOf(o.responseText.substr(0,1))>-1?JSON.parse(o.responseText):{};o.status>=200&&o.status<400?"function"==typeof n&&n(t):"function"==typeof i&&i(t)},o.onerror=function(){"function"==typeof i&&i(o)},o.setRequestHeader("X-Requested-With","XMLHttpRequest"),e instanceof FormData||(e=JSON.stringify(e),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json")),"POST"===a?o.send(e):o.send()}},{key:"windowReload",value:function(){var t=window.location.protocol+"//"+window.location.hostname+window.location.pathname;window.location.href=t}},{key:"setToParents",value:function(t,e){t&&t.parentNode&&"BODY"!==t.tagName&&"BODY"!==t.parentNode.tagName&&(Object.keys(e).forEach((function(n){t.parentNode.style[n]=e[n]})),"BODY"!==t.tagName&&this.setToParents(t.parentNode,e))}},{key:"removeEl",value:function(t){t.parentNode.removeChild(t)}},{key:"insertAfter",value:function(t,e){e.parentNode.insertBefore(t,e.nextSibling)}},{key:"insertBefore",value:function(t,e){e.parentNode.insertBefore(t,e)}},{key:"getNodePreviousSiblingByType",value:function(t,e,n){return t.previousSibling&&t.previousSibling.nodeType!==e&&n>0?this.getNodePreviousSiblingByType(t.previousSibling,e,--n):t.previousSibling}},{key:"generateRandomString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*i));return e}},{key:"setCookie",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var a="expires="+i.toUTCString();document.cookie=t+"="+e+";"+a+";path=/"}},{key:"getCookie",value:function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""}}])&&a(e.prototype,n),i&&a(e,i),t}();"object"===i(e)&&(t.exports=o)},yLpj:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}});