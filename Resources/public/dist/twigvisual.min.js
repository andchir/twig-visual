!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./",n(n.s="QfWi")}({QfWi:function(t,e,n){(function(t){var e=n("eipz"),i=n("l7NG");t.twv_translations=e,t.TwigVisual=i}).call(this,n("yLpj"))},eipz:function(t,e){t.exports={en:{},ru:{}}},l7NG:function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=null,this.loading=!1,this.parentElement=null,this.dataKey="source",this.data={},this.actions=[],this.timer=null,this.components=[],this.options=Object.assign({templateName:"",templates:[],pageFields:[],uiOptions:{},locale:"en"},e),this.state="inactive",console.log(twv_translations),this.listenerOnMouseOver=this.onMouseOver.bind(this),this.listenerOnMouseOut=this.onMouseOut.bind(this),this.listenerOnMouseWheel=this.onMouseWheel.bind(this),this.listenerOnMouseClick=this.onSelectedElementClick.bind(this),this.currentElements=[],this.selectedElement=null,t.onReady(this.init.bind(this))}var e,n,i;return e=t,i=[{key:"onLoad",value:function(t){"complete"===document.readyState?t():window.addEventListener("load",t)}},{key:"onReady",value:function(t){"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t)}}],(n=[{key:"init",value:function(){var t=this;this.container=this.createContainer(),this.container.querySelector(".twv-button-start-select").addEventListener("click",(function(e){e.preventDefault(),e.target.setAttribute("disabled","disabled"),t.removeSelectionInner(),t.selectModeToggle(document.body,"source")})),this.container.querySelector(".twv-button-new-theme").addEventListener("click",(function(e){e.preventDefault(),"active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy(!0),t.addNewThemeInit()})),this.container.querySelector(".twv-button-new-template").addEventListener("click",(function(e){e.preventDefault(),"active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy(!0),t.addNewTemplateInit()})),document.body.addEventListener("keyup",(function(e){if("Escape"===e.code&&("active"===t.state&&t.selectModeToggle(),t.selectionModeDestroy()),"Enter"===e.code&&"active"===t.state){var n=document.querySelector(".twv-selected");t.selectModeApply(n)}}));var e=this.getCookie("twv-panel-class-name");e&&(this.container.className=e,this.container.classList.add("twig-visual-container"))}},{key:"selectModeToggle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"source",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t=t||this.parentElement,"inactive"===this.state)this.parentElement=t,this.dataKey=e,n&&(this.container.style.display="none"),t.addEventListener("mouseover",this.listenerOnMouseOver),t.addEventListener("mouseout",this.listenerOnMouseOut),t.addEventListener("wheel",this.listenerOnMouseWheel,{passive:!1}),t.addEventListener("click",this.listenerOnMouseClick),this.state="active";else{if(this.container.style.display="block",t.removeEventListener("mouseover",this.listenerOnMouseOver),t.removeEventListener("mouseout",this.listenerOnMouseOut),t.removeEventListener("wheel",this.listenerOnMouseWheel),t.removeEventListener("click",this.listenerOnMouseClick),this.container.querySelector(".twv-ui-components")){var i=this.container.querySelector(".twv-ui-components").querySelectorAll("button");Array.from(i).forEach((function(t){t.removeAttribute("disabled")}))}var o=this.container.querySelector(".twv-button-start-select");o.removeAttribute("disabled"),this.state="inactive",this.onAfterSelect()}}},{key:"onAfterSelect",value:function(){var t=this;switch(this.dataKey){case"moveTarget":var e=this.container.querySelector(".twv-inner"),n=this.container.querySelector(".twv-button-start-select");this.makeButtonSelected(n,!0,(function(){return t.selectionModeDestroy(!0),!0})),this.removeOverlay(),e.innerHTML="";var i=document.createElement("div");i.className="twv-pt-1 twv-mb-3",i.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="inside" checked="checked">\n                            Вставить\n                        </label>\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="before">\n                            Вставить до\n                        </label>\n                        <label class="twv-display-block">\n                            <input type="radio" name="insertMode" value="after">\n                            Вставить после\n                        </label>\n                    </div>\n                    <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                        <i class="twv-icon-done"></i>\n                        Применить\n                    </button>\n                    <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                        <i class="twv-icon-clearclose"></i>\n                    </button>\n                ',e.appendChild(i);var o=e.querySelector(".twv-button-submit"),a=e.querySelector(".twv-button-cancel");o.addEventListener("click",(function(n){n.preventDefault();var i=e.querySelector('input[name="insertMode"]:checked').value;t.showLoading(!0),t.request("/twigvisual/move_element",{templateName:t.options.templateName,xpath:t.data.source,xpathTarget:t.data.moveTarget,insertMode:i},(function(e){e.success?t.windowReload():t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST")})),a.addEventListener("click",(function(n){n.preventDefault(),e.innerHTML="",t.selectionModeDestroy(!0)}))}}},{key:"onMouseOver",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(this.currentElements=[],this.updateXPathInfo(t.target),t.target.classList.add("twv-selected"),this.displayPadding(t.target))}},{key:"onMouseOut",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(this.currentElements=[],Array.from(document.querySelectorAll(".twv-selected")).forEach((function(t){t.classList.remove("twv-selected"),t.style.boxShadow=""})))}},{key:"onSelectedElementClick",value:function(t){!this.getXPathForElement(t.target,!0)||this.getXPathForElement(t.target,!0).indexOf("twig-visual-container")>-1||(t.preventDefault(),t.stopPropagation(),this.selectModeApply(t.target))}},{key:"selectModeApply",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:e;if(n){this.removeOverlay();var i=this.getXPathForElement(n);if(this.data[this.dataKey]=i,this.data[this.dataKey]){var o=this.data[this.dataKey];this.removeSelectionInnerByXPath(o)}if("active"===this.state&&this.selectModeToggle(),this.selectionModeDestroy(),"source"===this.dataKey)this.parentElement=n,this.createSelectionOptions(i);else{this.highlightElement(),n.classList.add("twv-selected-success");var a=this.components.findIndex((function(e){return e.name===t.dataKey}));a>-1&&(n.getAttribute("title")&&!n.dataset.twvTitle&&(n.dataset.twvTitle=n.getAttribute("title")),n.setAttribute("title",this.components[a].title)),this.componentButtonMakeSelected(this.dataKey)}}}},{key:"selectionModeDestroy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];document.querySelector(".twv-info")&&this.removeEl(document.querySelector(".twv-info"));var n=Array.from(document.querySelectorAll(".twv-selected"));if(n.forEach((function(t){t.classList.remove("twv-selected"),t.style.boxShadow=""})),t){e&&(this.data={}),this.currentElements=[],this.components=[];var i=this.container.querySelector(".twv-button-start-select");i.parentNode.classList.remove("twv-block-active-status-active"),this.container.querySelector(".twv-inner").innerHTML="",this.removeOverlay();var o=document.querySelector(".twv-selected-element");o&&(o.contentEditable=!1,o.dataset.twvContent&&(o.innerHTML=o.dataset.twvContent,o.dataset.twvContent=""),o.classList.remove("twv-selected-element"),o.style.transform="",o.style.transition="",this.setToParents(o,{transform:"",transition:""})),this.removeSelectionInner()}}},{key:"onMouseWheel",value:function(t){if(!(this.getXPathForElement(t.target).indexOf("twig-visual-container")>-1)){t.preventDefault();var e=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:t.target;t.deltaY<0?(e.classList.remove("twv-selected"),e.style.boxShadow="",this.currentElements.push(e.parentNode),this.updateXPathInfo(e.parentNode),e.parentNode.classList.add("twv-selected"),this.displayPadding(e.parentNode)):(e.classList.remove("twv-selected"),e.style.boxShadow="",this.currentElements.splice(this.currentElements.length-1,1),e=this.currentElements.length>0?this.currentElements[this.currentElements.length-1]:t.target,this.updateXPathInfo(e),e.classList.add("twv-selected"),this.displayPadding(e))}}},{key:"removeSelectionInner",value:function(){Array.from(document.querySelectorAll(".twv-selected-success")).forEach((function(t){t.dataset.twvTitle?t.setAttribute("title",t.dataset.twvTitle):t.removeAttribute("title"),t.classList.remove("twv-selected-success")}))}},{key:"removeSelectionInnerByXPath",value:function(t){this.removeOverlay();var e=this.getElementByXPath(t);return!!e&&(this.highlightElement(),e.dataset.twvTitle?e.setAttribute("title",e.dataset.twvTitle):e.removeAttribute("title"),e.classList.remove("twv-selected-success"),!0)}},{key:"highlightElement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twv-selected-element";if(t||(t=this.parentElement),t&&"BODY"!==t.tagName&&!document.querySelector(".twv-back-overlay")){t.classList.add(e);var n=window.getComputedStyle(t),i=n.getPropertyValue("position"),o=n.getPropertyValue("background-color");"static"===i&&(t.style.position="relative"),["rgba(0, 0, 0, 0)","transparent"].indexOf(o),t.style.transform="none",t.style.transition="none",this.setToParents(t,{transform:"none",transition:"none"});var a=document.createElement("LI"===t.tagName?"li":"div");a.className="twv-back-overlay",this.insertBefore(a,t)}}},{key:"removeOverlay",value:function(){document.querySelector(".twv-back-overlay")&&this.removeEl(document.querySelector(".twv-back-overlay"))}},{key:"updateXPathInfo",value:function(t){var e=this.getXPathForElement(t,!0);if(!(e.indexOf("twig-visual-container")>-1)){var n=document.querySelector(".twv-info");n||((n=document.createElement("div")).className="twv-info small",document.body.appendChild(n)),n.style.display="block",n.innerHTML="<div>".concat(e,"</div>")}}},{key:"getXPathForElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(""!==t.id)return'id("'+t.id+'")';if("HTML"===t.tagName)return"/HTML[1]".toLowerCase();if(t===document.body)return"/HTML[1]/BODY[1]".toLowerCase();if(!t.parentNode)return"";for(var n=0,i=t.parentNode.childNodes,o=0;o<i.length;o++){var a=i[o];if(a===t)return this.getXPathForElement(t.parentNode,e)+"/"+t.tagName.toLowerCase()+"["+(n+1)+"]"+(e?this.getXpathElementAttributes(t):"");a.nodeType===Node.ELEMENT_NODE&&a.tagName===t.tagName&&n++}}},{key:"getXpathElementAttributes",value:function(t){return t.hasAttribute("id")?'id("'.concat(t.id,'")'):t.hasAttribute("class")&&t.getAttribute("class")?'[@class="'.concat(t.getAttribute("class"),'"]'):""}},{key:"getElementByXPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.document,n=document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return n.singleNodeValue}},{key:"createContainer",value:function(){var t=this,e=document.createElement("div");return e.id="twig-visual-container",e.className="twig-visual-container twv-panel-right",e.innerHTML='\n        <div class="twv-panel-header">\n            <div class="twv-panel-header-buttons">\n                <button class="twv-btn twv-btn-sm twv-ml-1 twv-button-undo" type="button" title="Отменить последнее действие">\n                    <i class="twv-icon-undo"></i>\n                </button>\n                <button class="twv-btn twv-btn-sm twv-ml-1 twv-button-execute-batch" type="button" title="Выполнить пакет операций" style="display: none;">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                    <span></span>\n                </button>\n            </div>\n            <button class="twv-btn twv-btn-sm twv-mr-1 twv-button-panel-left" type="button" title="Передвинуть влево">\n                <i class="twv-icon-arrow_back"></i>\n            </button>\n            <button class="twv-btn twv-btn-sm twv-button-panel-right" type="button" title="Передвинуть вправо">\n                <i class="twv-icon-arrow_forward"></i>\n            </button>\n        </div>\n        <div class="twv-mb-2">\n            <button type="button" class="twv-btn twv-btn-block twv-button-new-theme">\n                <i class="twv-icon-add"></i>\n                Создать новую тему\n            </button>\n        </div>\n        <div class="twv-mb-2">\n            <button type="button" class="twv-btn twv-btn-block twv-button-new-template">\n                <i class="twv-icon-add"></i>\n                Создать шаблон\n            </button>\n        </div>\n        <div class="twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-btn-block twv-button-start-select">\n                <i class="twv-icon-center_focus_strong"></i>\n                Блок интерфейса\n            </button>\n        </div>\n        <div class="twv-inner-wrapper">\n            <div class="twv-inner"></div>\n        </div>\n        ',document.body.appendChild(e),e.querySelector(".twv-button-panel-left").addEventListener("click",(function(e){e.preventDefault(),t.panelMove("left")})),e.querySelector(".twv-button-panel-right").addEventListener("click",(function(e){e.preventDefault(),t.panelMove("right")})),e.querySelector(".twv-button-execute-batch").addEventListener("click",(function(e){e.preventDefault(),t.executeActionBatch()})),e.querySelector(".twv-button-undo").addEventListener("click",(function(e){e.preventDefault(),t.restoreFromTemplateCopyA()})),e}},{key:"panelMove",value:function(t){var e="twv-panel-".concat(t);return this.container.classList.contains(e)?(this.container.classList.add("twv-panel-hidden"),void this.setCookie("twv-panel-class-name",this.container.className)):this.container.classList.contains("twv-panel-hidden")?(this.container.classList.remove("twv-panel-hidden"),void this.setCookie("twv-panel-class-name",this.container.className)):(this.container.classList.remove("twv-panel-"+("left"===t?"right":"left")),this.container.classList.add(e),void this.setCookie("twv-panel-class-name",this.container.className))}},{key:"onBlockUiTypeChange",value:function(t,e){var n=this,i=this.container.querySelector(".twv-ui-components");if(i.innerHTML="",this.removeSelectionInner(),e&&this.options.uiOptions[e]){Object.keys(this.data).forEach((function(t){"source"!==t&&delete n.data[t]}));var o=document.createElement("div"),a="";o.className="twv-pt-1 twv-mb-3";var s=this.options.uiOptions[e];this.components=s.components,this.components.forEach((function(e){var s=document.createElement("div");switch(s.className="",e.type){case"elementSelect":s.innerHTML='<div class="twv-mb-2">\n                        <button data-twv-key="'.concat(e.name,'" class="twv-btn twv-btn-block twv-text-overflow">').concat(e.title,"</button>\n                    </div>\n                    "),s.querySelector("button").addEventListener("click",(function(i){i.preventDefault(),"active"!==n.state&&(i.target.setAttribute("disabled","disabled"),n.selectModeToggle(t,e.name,!1))})),o.appendChild(s);break;case"text":var l="";if(e.styleName){var r=window.getComputedStyle(n.parentElement);r[e.styleName]&&(l=r[e.styleName])}s.innerHTML='\n                    <div class="twv-mb-2">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(e.name,'">').concat(e.title,'</label>\n                        <input type="text" id="tww-field-option-').concat(e.name,'" class="twv-form-control" name="').concat(e.name,'" value="').concat(l,'">\n                    </div>\n                    '),o.appendChild(s);break;case"checkbox":s.innerHTML='\n                    <div class="twv-mb-2">\n                        <input type="checkbox" id="tww-field-option-'.concat(e.name,'" name="').concat(e.name,'" value="1">\n                        <label class="twv-display-inline twv-small twv-ml-1" for="tww-field-option-').concat(e.name,'">').concat(e.title,"</label>\n                    </div>\n                    "),o.appendChild(s);break;case"pageField":a="",n.options.pageFields.forEach((function(t){a+='<option value="'.concat(t.name,'" data-type="').concat(t.type,'">').concat(t.name," - ").concat(t.type,"</option>")})),s.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(e.name,'">').concat(e.title,'</label>\n                        <select id="tww-field-option-').concat(e.type,'" class="twv-custom-select" name="fieldName">\n                            ').concat(a,"\n                        </select>\n                    </div>\n                    "),o.appendChild(s);var c=function(t,e){var n=i.querySelector('input[name="key"]');n&&(n.parentNode.style.display=["object","array"].indexOf(e)>-1?"block":"none",-1===["object","array"].indexOf(e)&&(n.value=""))};s.querySelector("select").addEventListener("change",(function(t){var e=t.target,n=e.options[e.selectedIndex];c(e.value,n.dataset.type)})),setTimeout((function(){c(s.querySelector("select").value,s.querySelector("select").querySelector("option").dataset.type)}),1);break;case"include":a="",n.showLoading(!0),n.request("/twigvisual/includes",{},(function(t){t.templates&&(t.templates.forEach((function(t){a+='<option value="'.concat(t,'">').concat(t,"</option>")})),s.querySelector("select").innerHTML=a),n.showLoading(!1)}),(function(t){n.addAlertMessage(t.error||t),n.showLoading(!1)})),s.innerHTML='\n                    <div class="twv-mb-3">\n                        <label class="twv-display-block twv-mb-1" for="tww-field-option-'.concat(e.name,'">').concat(e.title,'</label>\n                        <select id="tww-field-option-').concat(e.type,'" class="twv-custom-select" name="').concat(e.name,'">\n                            ').concat(a,"\n                        </select>\n                    </div>\n                    "),o.appendChild(s)}})),i.appendChild(o),(o=document.createElement("div")).className="twv-pt-1 twv-mb-3",o.innerHTML='\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                <i class="twv-icon-done"></i>\n                Применить\n            </button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                <i class="twv-icon-clearclose"></i>\n            </button>\n        ',i.appendChild(o);var l=this.container.querySelector(".twv-button-submit"),r=this.container.querySelector(".twv-button-cancel");l.addEventListener("click",(function(t){t.preventDefault();var o={templateName:n.options.templateName,data:n.data};Array.from(i.querySelectorAll('input[type="text"]')).forEach((function(t){o.data[t.name]=t.value})),Array.from(i.querySelectorAll("select")).forEach((function(t){o.data[t.name]=t.value})),Array.from(i.querySelectorAll('input[type="checkbox"]')).forEach((function(t){o.data[t.name]=t.checked})),n.checkRequired(o.data,n.components)&&(l.setAttribute("disabled","disabled"),r.setAttribute("disabled","disabled"),n.showLoading(!0),n.request("/twigvisual/insert/".concat(e),o,(function(t){t.success?n.windowReload():(l.removeAttribute("disabled"),r.removeAttribute("disabled"),n.showLoading(!1))}),(function(t){n.addAlertMessage(t.error||t),l.removeAttribute("disabled"),r.removeAttribute("disabled"),n.showLoading(!1)}),"POST"))})),r.addEventListener("click",(function(t){t.preventDefault();var e=n.container.querySelector(".twv-ui-element-select > select"),i=document.querySelector(".twv-selected-element");document.querySelector(".twv-info")&&n.removeEl(document.querySelector(".twv-info")),"active"!==n.state?e.value?(e.value="",n.selectionModeDestroy(),n.onBlockUiTypeChange(i)):n.selectionModeDestroy(!0):n.selectModeToggle()}))}}},{key:"checkRequired",value:function(t,e){var n=!0,i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var r=s.value;if(r.required&&!t[r.name]){n=!1,alert('Поле "'.concat(r.title,'" - обязательно.'));break}}}catch(t){o=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}return n}},{key:"componentButtonMakeSelected",value:function(t){var e=this,n=this.container.querySelector(".twv-ui-components");if(n){var i=Array.from(n.querySelectorAll("button"));1===(i=i.filter((function(e){return e.dataset.twvKey===t}))).length&&this.makeButtonSelected(i[0],!0,(function(){var n=e.data[t]||null;return!!e.removeSelectionInnerByXPath(n)&&(delete e.data[t],!0)}))}}},{key:"makeButtonSelected",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t.removeAttribute("disabled"),t.parentNode.classList.contains("twv-block-active-status"))n?t.parentNode.classList.add("twv-block-active-status-active"):t.parentNode.classList.remove("twv-block-active-status-active");else{var o=t.textContent.trim(),a=document.createElement("div");a.innerHTML='\n        <div class="twv-block-active-status twv-block-active-status-active">\n            <div class="twv-block-active-status-active-content">\n                <div class="twv-input-group">\n                    <span class="twv-input-group-text twv-flex-fill" title="'.concat(o,'">\n                        <i class="twv-icon-done twv-mr-2 twv-text-success"></i>\n                        Выбрано\n                    </span>\n                    <div class="twv-input-group-append">\n                        <button class="twv-btn twv-block-active-status-button-cancel" title="Отменить">\n                            <i class="twv-icon-clearclose"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        '),t.classList.add("twv-block-active-status-inactive-content"),this.insertAfter(a,t),a.querySelector(".twv-block-active-status").appendChild(t),t.parentNode.querySelector(".twv-block-active-status-button-cancel").addEventListener("click",(function(n){n.preventDefault(),"function"==typeof i?i()&&e.makeButtonSelected(t,!1):e.makeButtonSelected(t,!1)}))}}},{key:"createSelectionOptions",value:function(t){var e=this,n=this.getElementByXPath(t);if(!n)throw new Error("Element for XPath not found.");var i=this.container.querySelector(".twv-button-start-select");this.makeButtonSelected(i,!0,(function(){return e.selectionModeDestroy(!0),!0})),this.container.querySelector(".twv-inner").innerHTML="";var o="";Object.keys(this.options.uiOptions).forEach((function(t){o+='<option value="'.concat(t,'">').concat(e.options.uiOptions[t].title,"</option>")}));var a=t.replace(/[\"]/g,"&quot;"),s=document.createElement("div");s.innerHTML='\n        <b>XPath:</b>\n        <div class="twv-p-1 twv-mb-3 twv-small twv-bg-gray">\n            <div class="twv-text-overflow" title="'.concat(a,'">').concat(t,'</div>\n        </div>\n        <div class="twv-mb-3 twv-nowrap">\n            <button type="button" class="twv-btn twv-mr-1 twv-button-edit-text" title="Edit text content">\n                <i class="twv-icon-createmode_editedit"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-edit-link" title="Edit link">\n                <i class="twv-icon-linkinsert_link"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-replace-image" title="Replace image">\n                <i class="twv-icon-insert_photoimagephoto"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-delete-element" title="Delete element">\n                <i class="twv-icon-delete_outline"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-move-element" title="Move element">\n                <i class="twv-icon-move"></i>\n            </button>\n            <button type="button" class="twv-btn twv-mr-1 twv-button-restore-static" title="Restore static">\n                <i class="twv-icon-cached"></i>\n            </button>\n        </div>\n        <div class="twv-mb-3 twv-ui-element-select">\n            <select class="twv-custom-select">\n                <option value="">- Тип блока интерфейса -</option>\n                ').concat(o,'\n            </select>\n        </div>\n        <div class="twv-mb-3 twv-ui-components"></div>\n        '),this.container.querySelector(".twv-inner").appendChild(s),this.container.querySelector(".twv-ui-element-select > select").addEventListener("change",(function(t){e.onBlockUiTypeChange(n,t.target.value)})),this.container.querySelector(".twv-button-edit-text").addEventListener("click",(function(t){t.preventDefault(),e.editTextContentInit(n)})),this.container.querySelector(".twv-button-edit-link").addEventListener("click",(function(t){t.preventDefault(),e.editLinkInit(n)})),this.container.querySelector(".twv-button-delete-element").addEventListener("click",(function(t){t.preventDefault(),e.deleteElementInit(n)})),this.container.querySelector(".twv-button-move-element").addEventListener("click",(function(t){t.preventDefault(),t.target.setAttribute("disabled","disabled"),e.moveElementInit()})),this.container.querySelector(".twv-button-restore-static").addEventListener("click",(function(t){t.preventDefault(),e.restoreStaticInit()})),this.highlightElement(n,"twv-selected-element")}},{key:"editTextContentInit",value:function(t){var e=this;this.clearMessage();var n=this.container.querySelector(".twv-ui-components"),i=t.innerHTML;n.innerHTML="";var o=document.createElement("div");o.innerHTML='\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    Сохранить\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="Добавить в список операций">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            ',n.appendChild(o),t.dataset.twvContent=i,t.contentEditable=!0,t.focus();var a=this.container.querySelector(".twv-button-submit"),s=this.container.querySelector(".twv-button-cancel");a.addEventListener("click",(function(n){n.preventDefault(),t.contentEditable=!1,a.setAttribute("disabled","disabled"),s.setAttribute("disabled","disabled"),e.showLoading(!0),e.request("/twigvisual/edit_content",{templateName:e.options.templateName,xpath:e.data.source,textContent:t.innerHTML},(function(t){t.success?e.windowReload():(a.removeAttribute("disabled"),s.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),a.removeAttribute("disabled"),s.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(n){n.preventDefault(),e.addToActionBatch("edit_content",e.data.source,{value:t.innerHTML})})),s.addEventListener("click",(function(e){e.preventDefault(),t.contentEditable=!1,n.innerHTML="",t.innerHTML=i}))}},{key:"editLinkInit",value:function(t){var e=this;if("a"===t.tagName.toLowerCase()){this.clearMessage();var n=this.container.querySelector(".twv-ui-components"),i=t.getAttribute("href"),o=t.getAttribute("target");n.innerHTML="";var a=document.createElement("div");a.innerHTML='\n            <div class="twv-mb-3">\n                <label class="twv-display-block twv-mb-1" for="tww-field-element-link">Ссылка</label>\n                <input type="text" id="tww-field-element-link" class="twv-form-control" value="'.concat(i,'">\n            </div>\n            <div class="twv-mb-3">\n                <label class="twv-display-block twv-mb-1" for="tww-field-element-link">Target</label>\n                <select id="tww-field-link-target" class="twv-custom-select">\n                    <option value="_self"').concat("_blank"!=o?' selected="selected"':"",'>_self</option>\n                    <option value="_blank"').concat("_blank"==o?' selected="selected"':"",'>_blank</option>\n                </select>\n            </div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    Сохранить\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="Добавить в список операций">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            '),n.appendChild(a);var s=this.container.querySelector(".twv-button-submit"),l=this.container.querySelector(".twv-button-cancel");s.addEventListener("click",(function(t){t.preventDefault(),e.showLoading(!0),e.request("/twigvisual/edit_link",{templateName:e.options.templateName,xpath:e.data.source,href:a.querySelector('input[type="text"]').value,target:a.querySelector("select").value},(function(t){t.success?e.windowReload():(s.removeAttribute("disabled"),l.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),s.removeAttribute("disabled"),l.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(t){t.preventDefault(),e.addToActionBatch("edit_link",e.data.source,{href:a.querySelector('input[type="text"]').value,target:a.querySelector("select").value})})),l.addEventListener("click",(function(e){e.preventDefault(),t.contentEditable=!1,n.innerHTML="",t.setAttribute("href",i)}))}else alert("The selected item must have tag A.")}},{key:"deleteElementInit",value:function(t){var e=this;this.clearMessage();var n=this.container.querySelector(".twv-ui-components");t.textContent.trim(),n.innerHTML="";var i=document.createElement("div");i.innerHTML='\n            <div class="twv-mb-3">Вы уверены, что хотите удалить выбранный элемент?</div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    Подтвердить\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-mr-1 twv-button-add-list" title="Добавить в список операций">\n                    <i class="twv-icon-format_list_bulleted"></i>\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            ',n.appendChild(i);var o=this.container.querySelector(".twv-button-submit"),a=this.container.querySelector(".twv-button-cancel");o.addEventListener("click",(function(t){t.preventDefault(),e.showLoading(!0),e.request("/twigvisual/delete_element",{templateName:e.options.templateName,xpath:e.data.source},(function(t){t.success?e.windowReload():(o.removeAttribute("disabled"),a.removeAttribute("disabled"),e.showLoading(!1))}),(function(t){e.addAlertMessage(t.error||t),o.removeAttribute("disabled"),a.removeAttribute("disabled"),e.showLoading(!1)}),"POST")})),a.addEventListener("click",(function(t){t.preventDefault(),n.innerHTML=""})),this.container.querySelector(".twv-button-add-list").addEventListener("click",(function(t){t.preventDefault(),e.addToActionBatch("delete",e.data.source)}))}},{key:"moveElementInit",value:function(){var t=this;this.container.querySelector(".twv-ui-components").innerHTML="",this.selectionModeDestroy(!0,!1),setTimeout((function(){t.selectModeToggle(document.body,"moveTarget")}),1)}},{key:"restoreStaticInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-ui-components");e.innerHTML="";var n=document.createElement("div");n.innerHTML='\n            <div class="twv-mb-3">Вы уверены, что хотите вернуть исходное состояние элемента?</div>\n            <div class="twv-mb-3">\n                <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">\n                    <i class="twv-icon-done"></i>\n                    Подтвердить\n                </button>\n                <button type="button" class="twv-btn twv-btn twv-button-cancel" title="Отменить">\n                    <i class="twv-icon-clearclose"></i>\n                </button>\n            </div>\n            ',e.appendChild(n);var i=e.querySelector(".twv-button-submit"),o=e.querySelector(".twv-button-cancel");i.addEventListener("click",(function(e){e.preventDefault(),t.showLoading(!0),t.request("/twigvisual/restore_static",{templateName:t.options.templateName,xpath:t.data.source},(function(e){e.success?t.windowReload():(i.removeAttribute("disabled"),o.removeAttribute("disabled"),t.showLoading(!1))}),(function(e){t.addAlertMessage(e.error||e),i.removeAttribute("disabled"),o.removeAttribute("disabled"),t.showLoading(!1)}),"POST")})),o.addEventListener("click",(function(n){n.preventDefault(),t.clearMessage(),e.innerHTML=""}))}},{key:"addNewThemeInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-inner");e.innerHTML="";var n=document.createElement("div");n.innerHTML='\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-theme-name">Название темы</label>\n            <input type="text" id="tww-field-theme-name" class="twv-form-control">\n        </div>\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-theme-mainpage">HTML-файл главной страницы</label>\n            <input type="text" id="tww-field-theme-mainpage" class="twv-form-control" value="index.html">\n        </div>\n        <div class="twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">Создать</button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel">Отменить</button>\n        </div>\n        ',e.appendChild(n),e.querySelector("button.twv-button-submit").addEventListener("click",(function(n){n.preventDefault();var i=document.getElementById("tww-field-theme-name"),o=document.getElementById("tww-field-theme-mainpage"),a=n.target;i.value&&o.value&&(t.clearMessage(),t.showLoading(!0),a.setAttribute("disabled","disabled"),t.request("/twigvisual/create",{theme:i.value,mainpage:o.value},(function(n){a.removeAttribute("disabled"),t.showLoading(!1),n&&n.success&&(e.innerHTML=""),n.message&&t.addAlertMessage(n.message,"success")}),(function(e){t.addAlertMessage(e.error||e),a.removeAttribute("disabled"),t.showLoading(!1)}),"POST"))})),e.querySelector("button.twv-button-cancel").addEventListener("click",(function(t){t.preventDefault(),e.innerHTML=""}))}},{key:"addNewTemplateInit",value:function(){var t=this;this.clearMessage();var e=this.container.querySelector(".twv-inner");e.innerHTML="";var n="";this.options.templates.forEach((function(t){n+='<option value="'.concat(t,'">').concat(t,"</option>")})),this.showLoading(!0),this.request("/twigvisual/html_files",{},(function(e){if(e.files){var n="";e.files.forEach((function(t){n+='<option value="'.concat(t,'">').concat(t,"</option>")})),document.getElementById("tww-field-source-file").innerHTML=n}t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}));var i=document.createElement("div");i.innerHTML='\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-source-file">HTML-файл</label>\n            <select id="tww-field-source-file" class="twv-custom-select"></select>\n        </div>\n        <div class="twv-mb-3">\n            <label class="twv-display-block twv-mb-1" for="tww-field-template-name">Название шаблона</label>\n            <select id="tww-field-template-name" class="twv-custom-select">\n                '.concat(n,'\n            </select>\n        </div>\n        <div class="twv-mb-3">\n            <button type="button" class="twv-btn twv-btn-primary twv-mr-1 twv-button-submit">Создать</button>\n            <button type="button" class="twv-btn twv-btn twv-button-cancel">Отменить</button>\n        </div>\n        '),e.appendChild(i),e.querySelector("button.twv-button-submit").addEventListener("click",(function(n){n.preventDefault();var i=document.getElementById("tww-field-source-file"),o=document.getElementById("tww-field-template-name"),a=n.target;i.value&&o.value&&(t.showLoading(!0),a.setAttribute("disabled","disabled"),t.request("/twigvisual/create_template",{fileName:i.value,templateName:o.value},(function(n){a.removeAttribute("disabled"),t.showLoading(!1),e.innerHTML="",n.message&&t.addAlertMessage(n.message,"success")}),(function(e){t.addAlertMessage(e.error||e),a.removeAttribute("disabled"),t.showLoading(!1)}),"POST"))})),e.querySelector("button.twv-button-cancel").addEventListener("click",(function(t){t.preventDefault(),e.innerHTML=""}))}},{key:"addToActionBatch",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.actions.push({action:t,xpath:e,options:i}),this.selectionModeDestroy(!0);var o=this.container.querySelector(".twv-button-execute-batch");o.querySelector("span").textContent="".concat(this.actions.length),o.style.display="inline-block",this.actions.forEach((function(t){var e=n.getElementByXPath(t.xpath);e&&e.classList.add("twv-selected-success")}))}},{key:"executeActionBatch",value:function(){var t=this;0!==this.actions.length&&(this.showLoading(!0),this.request("/twigvisual/batch",{templateName:this.options.templateName,actions:this.actions},(function(e){e.success&&t.windowReload(),t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST"))}},{key:"restoreFromTemplateCopyA",value:function(){var t=this;this.showLoading(!0),this.request("/twigvisual/restore_backup",{templateName:this.options.templateName},(function(e){e.success&&t.windowReload(),t.showLoading(!1)}),(function(e){t.addAlertMessage(e.error||e),t.showLoading(!1)}),"POST")}},{key:"showLoading",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=t,t?this.container.classList.add("twv-loading"):this.container.classList.remove("twv-loading")}},{key:"addAlertMessage",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"danger";clearTimeout(this.timer);var i=this.container.querySelector(".twv-inner");i.querySelector(".twv-alert")&&this.removeEl(i.querySelector(".twv-alert"));var o=document.createElement("div");o.innerHTML='\n        <div class="twv-alert twv-alert-'.concat(n,'">').concat(t,"</div>\n        "),i.appendChild(o),o.addEventListener("mouseenter",(function(){clearTimeout(e.timer)})),o.addEventListener("mouseleave",(function(){e.timer=setTimeout(e.clearMessage.bind(e),4e3)})),this.timer=setTimeout(this.clearMessage.bind(this),4e3)}},{key:"clearMessage",value:function(){var t=this.container.querySelector(".twv-inner");t.querySelector(".twv-alert")&&this.removeEl(t.querySelector(".twv-alert"))}},{key:"displayPadding",value:function(t){var e=window.getComputedStyle(t),n="0 0 0 2px #007bff";"0px"!==e["padding-top"]&&(n+=", inset 0 ".concat(e["padding-top"]," 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-bottom"]&&(n+=", inset 0 -".concat(e["padding-bottom"]," 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-left"]&&(n+=", inset ".concat(e["padding-left"]," 0 0 0 rgba(50,168,82,0.15)")),"0px"!==e["padding-right"]&&(n+=", inset -".concat(e["padding-right"]," 0 0 0 rgba(50,168,82,0.15)")),n&&(t.style.boxShadow=n)}},{key:"request",value:function(t,e,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"GET",a=new XMLHttpRequest;a.open(o,t,!0),a.onload=function(){var t=["{","["].indexOf(a.responseText.substr(0,1))>-1?JSON.parse(a.responseText):{};a.status>=200&&a.status<400?"function"==typeof n&&n(t):"function"==typeof i&&i(t)},a.onerror=function(){"function"==typeof i&&i(a)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),e instanceof FormData||(e=JSON.stringify(e),a.setRequestHeader("Content-type","application/json; charset=utf-8")),"POST"===o?a.send(e):a.send()}},{key:"windowReload",value:function(){var t=window.location.protocol+"//"+window.location.hostname+window.location.pathname;window.location.href=t}},{key:"setToParents",value:function(t,e){t&&t.parentNode&&"BODY"!==t.tagName&&"BODY"!==t.parentNode.tagName&&(Object.keys(e).forEach((function(n){t.parentNode.style[n]=e[n]})),"BODY"!==t.tagName&&this.setToParents(t.parentNode,e))}},{key:"removeEl",value:function(t){t.parentNode.removeChild(t)}},{key:"insertAfter",value:function(t,e){e.parentNode.insertBefore(t,e.nextSibling)}},{key:"insertBefore",value:function(t,e){e.parentNode.insertBefore(t,e)}},{key:"getNodePreviousSiblingByType",value:function(t,e,n){return t.previousSibling&&t.previousSibling.nodeType!==e&&n>0?this.getNodePreviousSiblingByType(t.previousSibling,e,--n):t.previousSibling}},{key:"generateRandomString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*i));return e}},{key:"setCookie",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="expires="+i.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}},{key:"getCookie",value:function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}}])&&o(e.prototype,n),i&&o(e,i),t}();"object"===i(e)&&(t.exports=a)},yLpj:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}});