{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"twigvisual.js","sourcesContent":["\nclass TwigVisual {\n\n    constructor(options) {\n        this.parentElement = null;\n        this.dataKey = 'source';\n        this.data = {};\n        this.components = [];\n        this.options = Object.assign({\n            uiOptions: {\n                field: {\n                    components: []\n                },\n                photogallery: {\n                    components: []\n                },\n                menu: {\n                    components: [\n                        {\n                            name: \"firstItem\", title: \"Пункт меню первого уровня\", type: \"\"\n                        },\n                        {\n                            name: \"secondItem\", title: \"Пункт меню второго уровня\", type: \"\"\n                        }\n                    ]\n                },\n                breadcrumbs: {\n                    components: [\n                        {\n                            name: \"linkHomePage\", title: \"Ссылка на главную страницу\", type: \"\"\n                        },\n                        {\n                            name: \"item\", title: \"Ссылка\", type: \"\"\n                        }\n                    ]\n                },\n                \"shopping-cart\": {\n                    components: [\n                        {\n                            name: \"totalPrice\", title: \"Общая цена\", type: \"\"\n                        },\n                        {\n                            name: \"totalCount\", title: \"Общее количество\", type: \"\"\n                        },\n                        {\n                            name: \"lickCheckout\", title: \"Ссылка на оформление\", type: \"\"\n                        },\n                        {\n                            name: \"buttonClean\", title: \"Кнопка очистки\", type: \"\"\n                        }\n                    ]\n                },\n                \"products-list\": {\n                    components: []\n                },\n                comments: {\n                    components: []\n                }\n            }\n        }, options);\n        this.container = this.createContainer();\n        this.state = 'inactive';\n\n        this.listenerOnMouseOver = this.onMouseOver.bind(this);\n        this.listenerOnMouseOut = this.onMouseOut.bind(this);\n        this.listenerOnMouseWheel = this.onMouseWheel.bind(this);\n        this.listenerOnMouseClick = this.onSelectedElementClick.bind(this);\n        this.currentElements = [];\n\n        this.init();\n    }\n\n    static onReady(cb) {\n        if (document.readyState !== 'loading') {\n            cb();\n        } else {\n            document.addEventListener('DOMContentLoaded', cb);\n        }\n    };\n\n    init() {\n\n        this.parentElement = document.body;\n\n        // Start button\n        const buttonStart = this.container.querySelector('.twv-button-start-select');\n        buttonStart.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.target.setAttribute('disabled', 'disabled');\n            this.selectModeToggle(document.body, 'source');\n        });\n\n        // Add new theme\n        const buttonAddTheme = this.container.querySelector('.twv-button-new-theme');\n        buttonAddTheme.addEventListener('click', (e) => {\n            e.preventDefault();\n            if (this.state === 'active') {\n                this.selectModeToggle();\n            }\n            this.selectionModeDestroy(true);\n            this.addNewTheme();\n        });\n\n        document.body.addEventListener('keyup', (e) => {\n            if (e.code !== 'Escape') {\n                return;\n            }\n            if (this.state === 'active') {\n                this.selectModeToggle();\n            }\n            this.selectionModeDestroy();\n        });\n    }\n\n    selectModeToggle(parentEl, dataKey = 'source', hidePanel = true) {\n        parentEl = parentEl || this.parentElement;\n        if (this.state === 'inactive') {\n            this.parentElement = parentEl;\n            this.dataKey = dataKey;\n            if (hidePanel) {\n                this.container.style.display = 'none';\n            }\n            parentEl.addEventListener('mouseover', this.listenerOnMouseOver);\n            parentEl.addEventListener('mouseout', this.listenerOnMouseOut);\n            parentEl.addEventListener('wheel', this.listenerOnMouseWheel, {passive: false});\n            parentEl.addEventListener('click', this.listenerOnMouseClick);\n            this.state = 'active';\n        } else {\n            this.container.style.display = 'block';\n            parentEl.removeEventListener('mouseover', this.listenerOnMouseOver);\n            parentEl.removeEventListener('mouseout', this.listenerOnMouseOut);\n            parentEl.removeEventListener('wheel', this.listenerOnMouseWheel);\n            parentEl.removeEventListener('click', this.listenerOnMouseClick);\n            this.state = 'inactive';\n        }\n    }\n\n    onMouseOver(e) {\n        if (this.getXPathForElement(e.target, true).indexOf('twig-visual-container') > -1) {\n            return;\n        }\n        this.currentElements = [];\n        this.updateXPathInfo(e.target);\n        e.target.classList.add('twv-selected');\n    }\n\n    onMouseOut(e) {\n        if (this.getXPathForElement(e.target, true).indexOf('twig-visual-container') > -1) {\n            return;\n        }\n        this.currentElements = [];\n        const elements = Array.from(document.querySelectorAll('.twv-selected'));\n        elements.forEach((element) => {\n            element.classList.remove('twv-selected');\n        });\n    }\n\n    onSelectedElementClick(e) {\n        if (this.getXPathForElement(e.target, true).indexOf('twig-visual-container') > -1) {\n            return;\n        }\n        e.preventDefault();\n\n        this.selectModeToggle();\n\n        let currentElement = this.currentElements.length > 0\n            ? this.currentElements[this.currentElements.length - 1]\n            : e.target;\n        this.selectionModeDestroy();\n\n        // Clear selection\n        if (this.data[this.dataKey]) {\n            const xpath = this.data[this.dataKey];\n            this.removeSelectionInnerByXPath(xpath);\n        }\n\n        const xpath = this.getXPathForElement(currentElement);\n        this.data[this.dataKey] = xpath;\n\n        console.log(this.dataKey, this.data);\n\n        if (this.dataKey === 'source') {\n            this.createSelectionOptions(xpath);\n        } else {\n\n            currentElement.classList.add('twv-selected-success');\n\n            const index = this.components.findIndex((item) => {\n                return item.name === this.dataKey;\n            });\n            if (index > -1) {\n                if (currentElement.getAttribute('title') && !currentElement.dataset.twvTitle) {\n                    currentElement.dataset.twvTitle = currentElement.getAttribute('title');\n                }\n                currentElement.setAttribute('title', this.components[index].title);\n            }\n\n            this.componentButtonMakeSelected(this.dataKey);\n        }\n    }\n\n    selectionModeDestroy(reset = false) {\n        this.state = 'inactive';\n        if (document.querySelector('.twv-info')) {\n            this.removeEl(document.querySelector('.twv-info'));\n        }\n        const elements = Array.from(document.querySelectorAll('.twv-selected'));\n        elements.forEach((element) => {\n            element.classList.remove('twv-selected');\n        });\n\n        if (reset) {\n            this.data = {};\n            this.currentElements = [];\n            this.components = [];\n            const buttonStart = this.container.querySelector('.twv-button-start-select');\n\n            // Remove options\n            buttonStart.parentNode.classList.remove('twv-block-active-status-active');\n            this.container.querySelector('.twv-inner').innerHTML = '';\n\n            // Remove overlay\n            if (document.querySelector('.twv-back-overlay')) {\n                this.removeEl(document.querySelector('.twv-back-overlay'));\n            }\n\n            // Remove selection of parent element\n            const elementSelected = document.querySelector('.twv-selected-element');\n            if (elementSelected) {\n                elementSelected.classList.remove('twv-selected-element');\n            }\n\n            this.removeSelectionInner();\n        }\n    }\n\n    onMouseWheel(e) {\n        if (this.getXPathForElement(e.target).indexOf('twig-visual-container') > -1) {\n            return;\n        }\n        e.preventDefault();\n        let currentElement = this.currentElements.length > 0\n            ? this.currentElements[this.currentElements.length - 1]\n            : e.target;\n        if (e.deltaY < 0) {\n            currentElement.classList.remove('twv-selected');\n            this.currentElements.push(currentElement.parentNode);\n\n            this.updateXPathInfo(currentElement.parentNode);\n            currentElement.parentNode.classList.add('twv-selected');\n        } else {\n            currentElement.classList.remove('twv-selected');\n            this.currentElements.splice(this.currentElements.length - 1, 1);\n            currentElement = this.currentElements.length > 0\n                ? this.currentElements[this.currentElements.length - 1]\n                : e.target;\n\n            this.updateXPathInfo(currentElement);\n            currentElement.classList.add('twv-selected');\n        }\n    }\n\n    /**\n     * Remove selection of inner elements\n     */\n    removeSelectionInner() {\n        const selectedElements = Array.from(document.querySelectorAll('.twv-selected-success'));\n        selectedElements.forEach((element) => {\n            if (element.dataset.twvTitle) {\n                element.setAttribute('title', element.dataset.twvTitle);\n            } else {\n                element.removeAttribute('title');\n            }\n            element.classList.remove('twv-selected-success');\n        });\n    }\n\n    /**\n     * Remove selection by XPath\n     * @param xpath\n     */\n    removeSelectionInnerByXPath(xpath) {\n        const element = this.getElementByXPath(xpath);\n        if (element.dataset.twvTitle) {\n            element.setAttribute('title', element.dataset.twvTitle);\n        } else {\n            element.removeAttribute('title');\n        }\n        element.classList.remove('twv-selected-success');\n    }\n\n    updateXPathInfo(element) {\n        const xpath = this.getXPathForElement(element, true);\n        if (xpath.indexOf('twig-visual-container') > -1) {\n            return;\n        }\n        let div = document.querySelector('.twv-info');\n        if (!div) {\n            div = document.createElement('div');\n            div.className = 'twv-info small';\n            document.body.appendChild(div);\n        }\n        div.style.display = 'block';\n        div.innerHTML = `<div>${xpath}</div>`;\n    }\n\n    getXPathForElement(element, getAttributes = false) {\n        if (element.id !== '')\n            return 'id(\"' + element.id + '\")';\n        if (element.tagName === 'HTML')\n            return ('/HTML[1]').toLowerCase();\n        if (element === document.body)\n            return ('/HTML[1]/BODY[1]').toLowerCase();\n\n        let ix = 0;\n        const siblings = element.parentNode.childNodes;\n        for (let i = 0; i < siblings.length; i++) {\n            const sibling = siblings[i];\n            if (sibling === element) {\n                return this.getXPathForElement(element.parentNode, getAttributes) + '/'\n                    + element.tagName.toLowerCase() + '[' + (ix + 1) + ']'\n                    + (getAttributes ? this.getXpathElementAttributes(element) : '');\n            }\n            if (sibling.nodeType === 1 && sibling.tagName === element.tagName)\n                ix++;\n        }\n    }\n\n    getXpathElementAttributes(element) {\n        if (element.hasAttribute('id')) {\n            return `id(\"${element.id}\")`;\n        } else if(element.hasAttribute('class') && element.getAttribute('class')) {\n            return `[@class=\"${element.getAttribute('class')}\"]`;\n        }\n        return  '';\n    }\n\n    getElementByXPath(xpath) {\n        return document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n    }\n\n    createContainer() {\n        const containerEl = document.createElement('div');\n        containerEl.id = 'twig-visual-container';\n        containerEl.className = 'twig-visual-container twv-panel-right';\n        containerEl.innerHTML = `\n<div class=\"twv-panel-header\">\n    <button class=\"twv-btn twv-btn-sm twv-mr-1 twv-button-panel-left\" type=\"button\" title=\"Передвинуть влево\">\n        <i class=\"twv-icon-arrow_back\"></i>\n    </button>\n    <button class=\"twv-btn twv-btn-sm twv-button-panel-right\" type=\"button\" title=\"Передвинуть вправо\">\n        <i class=\"twv-icon-arrow_forward\"></i>\n    </button>\n</div>\n<div class=\"twv-mb-2\">\n    <button type=\"button\" class=\"twv-btn twv-btn-primary twv-btn-block twv-button-new-theme\">\n        <i class=\"twv-icon-add\"></i>\n        Создать новую тему\n    </button>\n</div>\n<div class=\"twv-mb-3\">\n    <button type=\"button\" class=\"twv-btn twv-btn-primary twv-btn-block twv-button-start-select\">\n        <i class=\"twv-icon-center_focus_strong\"></i>\n        Блок интерфейса\n    </button>\n</div>\n<div class=\"twv-inner\"></div>\n`;\n        document.body.appendChild(containerEl);\n\n        containerEl.querySelector('.twv-button-panel-left').addEventListener('click', (e) => {\n            e.preventDefault();\n            this.panelMove('left');\n        });\n\n        containerEl.querySelector('.twv-button-panel-right').addEventListener('click', (e) => {\n            e.preventDefault();\n            this.panelMove('right');\n        });\n\n        return containerEl;\n    }\n\n    panelMove(direction) {\n        const newClassName = `twv-panel-${direction}`;\n        if (this.container.classList.contains(newClassName)) {\n            this.container.classList.add('twv-panel-hidden');\n            return;\n        } else if (this.container.classList.contains('twv-panel-hidden')) {\n            this.container.classList.remove('twv-panel-hidden');\n            return;\n        }\n        this.container.classList.remove('twv-panel-' + (direction === 'left' ? 'right' : 'left'));\n        this.container.classList.add(newClassName);\n    }\n\n    createSelectionOptions(xpath) {\n        const elementSelected = this.getElementByXPath(xpath);\n        if (!elementSelected) {\n            throw new Error('Element for XPath not found.');\n        }\n        const buttonStart = this.container.querySelector('.twv-button-start-select');\n        this.makeButtonSelected(buttonStart, true, () => {\n            this.selectionModeDestroy(true);\n        });\n\n        this.container.querySelector('.twv-inner').innerHTML = '';\n\n        const xpathEscaped = xpath.replace(/[\\\"]/g, '&quot;');\n        const div = document.createElement('div');\n        div.innerHTML = `\n<b>XPath:</b>\n<div class=\"twv-p-1 twv-mb-3 twv-small twv-bg-gray\">\n    <div class=\"twv-text-overflow\" title=\"${xpathEscaped}\">${xpath}</div>\n</div>\n<div class=\"twv-mb-3 twv-ui-element-select\">\n    <select class=\"twv-custom-select\">\n        <option value=\"\">- Тип блока интерфейса -</option>\n        <option value=\"field\">Поле контента</option>\n        <option value=\"photogallery\">Фото-галерея</option>\n        <option value=\"menu\">Меню</option>\n        <option value=\"breadcrumbs\">Хлебные кношки</option>\n        <option value=\"shopping-cart\">Корзина товаров</option>\n        <option value=\"products-list\">Избранные товары</option>\n        <option value=\"comments\">Отзывы</option>\n    </select>\n</div>\n<div class=\"twv-mb-3 twv-ui-components\"></div>\n<div class=\"twv-mb-3\">\n    <button type=\"button\" class=\"twv-btn twv-btn-primary twv-button-submit\">Применить</button>\n</div>\n        `;\n        this.container.querySelector('.twv-inner').appendChild(div);\n\n        const componentsContainer = this.container.querySelector('.twv-ui-components');\n        const buttonSubmit = this.container.querySelector('.twv-button-submit');\n        buttonSubmit.style.display = 'none';\n\n        // Submit data\n        buttonSubmit.addEventListener('click', (e) => {\n            e.preventDefault();\n\n            console.log('SUBMIT', this.data);\n\n        });\n\n        // Select UI element type\n        this.container.querySelector('.twv-ui-element-select').addEventListener('change', (e) => {\n            componentsContainer.innerHTML = '';\n            this.removeSelectionInner();\n            if (!e.target.value) {\n                buttonSubmit.style.display = 'none';\n                return;\n            }\n            buttonSubmit.style.display = 'inline-block';\n            if (!this.options.uiOptions[e.target.value]) {\n                return;\n            }\n\n            // Clean components data\n            Object.keys(this.data).forEach((key) => {\n                if (key !== 'source') {\n                    delete this.data[key];\n                }\n            });\n\n            const opt = this.options.uiOptions[e.target.value];\n            this.components = opt.components;\n            this.components.forEach((cmp) => {\n                const div = document.createElement('div');\n                div.className = 'twv-mb-2';\n                div.innerHTML = `<button data-twv-key=\"${cmp.name}\" class=\"twv-btn twv-btn-block\">${cmp.title}</button>`;\n\n                componentsContainer.appendChild(div);\n\n                div.querySelector('button').addEventListener('click', (e) => {\n                    e.preventDefault();\n                    if (this.state === 'active') {\n                        return;\n                    }\n                    e.target.setAttribute('disabled', 'disabled');\n                    this.selectModeToggle(elementSelected, cmp.name, false);\n                });\n            });\n        });\n\n        const compStyles = window.getComputedStyle(elementSelected);\n        const position = compStyles.getPropertyValue('position');\n        const backgroundColor = compStyles.getPropertyValue('background-color');\n        if (position === 'static') {\n            elementSelected.style.position = 'relative';\n        }\n        if (['rgba(0, 0, 0, 0)', 'transparent'].indexOf(backgroundColor) > -1) {\n            // elementSelected.style.backgroundColor = '#fff';\n        }\n        const backgroundOverlay = document.createElement('div');\n        backgroundOverlay.className = 'twv-back-overlay';\n        // document.body.appendChild(backgroundOverlay);\n        this.insertBefore(backgroundOverlay, elementSelected);\n\n        elementSelected.classList.add('twv-selected-element');\n\n        console.log(xpath, backgroundColor, elementSelected, position);\n\n    }\n\n    componentButtonMakeSelected(dataKey) {\n        const componentsContainer = this.container.querySelector('.twv-ui-components');\n        let buttons = Array.from(componentsContainer.querySelectorAll('button'));\n        buttons = buttons.filter((buttonEl) => {\n            return buttonEl.dataset.twvKey === dataKey;\n        });\n        if (buttons.length === 1) {\n            this.makeButtonSelected(buttons[0], true, () => {\n                const xpath = this.data[dataKey] || null;\n                this.removeSelectionInnerByXPath(xpath);\n                delete this.data[dataKey];\n\n                console.log(this.data);\n            });\n        }\n    }\n\n    /**\n     * Mark button as selected\n     * @param buttonEl\n     * @param selected\n     * @param cancelFunc\n     */\n    makeButtonSelected(buttonEl, selected = true, cancelFunc = null) {\n        buttonEl.removeAttribute('disabled');\n        if (buttonEl.parentNode.classList.contains('twv-block-active-status')) {\n            if (selected) {\n                buttonEl.parentNode.classList.add('twv-block-active-status-active');\n            } else {\n                buttonEl.parentNode.classList.remove('twv-block-active-status-active');\n            }\n            return;\n        }\n        const title = buttonEl.textContent.trim();\n        const div = document.createElement('div');\n        div.innerHTML = `\n<div class=\"twv-block-active-status twv-block-active-status-active\">\n    <div class=\"twv-block-active-status-active-content\">\n        <div class=\"twv-input-group\">\n            <span class=\"twv-input-group-text twv-flex-fill\" title=\"${title}\">\n                <i class=\"twv-icon-done twv-mr-2 twv-text-success\"></i>\n                Выбрано\n            </span>\n            <div class=\"twv-input-group-append\">\n                <button class=\"twv-btn twv-block-active-status-button-cancel\" title=\"Отменить\">\n                    <i class=\"twv-icon-clearclose\"></i>\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n        `;\n\n        buttonEl.classList.add('twv-block-active-status-inactive-content');\n        this.insertAfter(div, buttonEl);\n        div.querySelector('.twv-block-active-status').appendChild(buttonEl);\n\n        buttonEl.parentNode.querySelector('.twv-block-active-status-button-cancel').addEventListener('click', (e) => {\n            e.preventDefault();\n            this.makeButtonSelected(buttonEl, false);\n            if (typeof cancelFunc === 'function') {\n                cancelFunc();\n            }\n        });\n    }\n\n    addNewTheme() {\n\n        const innerContainerEl = this.container.querySelector('.twv-inner');\n        innerContainerEl.innerHTML = '';\n\n        const div = document.createElement('div');\n        div.innerHTML = `\n        <div class=\"twv-mb-3\">\n            <label class=\"twv-display-block twv-mb-1\" for=\"tww-field-theme-name\">Название темы</label>\n            <input type=\"text\" id=\"tww-field-theme-name\" class=\"twv-form-control\">\n        </div>\n        <div class=\"twv-mb-3\">\n            <label class=\"twv-display-block twv-mb-1\" for=\"tww-field-theme-mainpage\">HTML-файл главной страницы</label>\n            <input type=\"text\" id=\"tww-field-theme-mainpage\" class=\"twv-form-control\" value=\"index.html\">\n        </div>\n        <div class=\"twv-mb-3\">\n            <button type=\"button\" class=\"twv-btn twv-btn-primary twv-mr-2 twv-button-submit\">Создать</button>\n            <button type=\"button\" class=\"twv-btn twv-btn twv-button-cancel\">Отменить</button>\n        </div>\n        `;\n\n        innerContainerEl.appendChild(div);\n\n        innerContainerEl.querySelector('button.twv-button-submit').addEventListener('click', (e) => {\n            e.preventDefault();\n            const fieldThemeEl = document.getElementById('tww-field-theme-name');\n            const fieldMainpageEl = document.getElementById('tww-field-theme-mainpage');\n            const buttonEl = e.target;\n            if (!fieldThemeEl.value) {\n                return;\n            }\n\n            console.log('SUBMIT', fieldThemeEl.value, fieldMainpageEl.value);\n\n            buttonEl.setAttribute('disabled', 'disabled');\n\n            this.request('/twig_visual/create', {\n                theme: fieldThemeEl.value,\n                mainpage: fieldMainpageEl.value\n            }, (res) => {\n                console.log(res);\n            }, (err) => {\n                console.log(err);\n                buttonEl.removeAttribute('disabled');\n            }, 'post');\n        });\n\n        innerContainerEl.querySelector('button.twv-button-cancel').addEventListener('click', (e) => {\n            e.preventDefault();\n            innerContainerEl.innerHTML = '';\n        });\n    }\n\n    request(url, data, successFn, failFn, method) {\n        method = method || 'GET';\n        const request = new XMLHttpRequest();\n        request.open(method, url, true);\n\n        request.onload = function() {\n            const result = ['{','['].indexOf(request.responseText.substr(0,1)) > -1\n                ? JSON.parse(request.responseText)\n                : {};\n            if (request.status >= 200 && request.status < 400) {\n                if (typeof successFn === 'function') {\n                    successFn(result);\n                }\n            } else {\n                if (typeof failFn === 'function') {\n                    failFn(result);\n                }\n            }\n        };\n\n        request.onerror = function() {\n            if (typeof failFn === 'function') {\n                failFn(request);\n            }\n        };\n\n        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        if (!(data instanceof FormData)) {\n            request.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n        }\n        if (method === 'POST') {\n            request.send(data);\n        } else {\n            request.send();\n        }\n    }\n\n    setToParents(element, styles) {\n        if (element.parentNode === document.body) {\n            return;\n        }\n        Object.keys(styles).forEach((key) => {\n            element.parentNode.style[key] = styles[key];\n        });\n        this.setToParents(element.parentNode, styles);\n    }\n\n    /**\n     * Remove HTML element\n     * @param el\n     */\n    removeEl(el) {\n        el.parentNode.removeChild(el);\n    };\n\n    /**\n     * Insert HTML element after other one\n     * @param newNode\n     * @param referenceNode\n     */\n    insertAfter(newNode, referenceNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n\n    /**\n     * Insert HTML element before other one\n     * @param newNode\n     * @param referenceNode\n     */\n    insertBefore(newNode, referenceNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode);\n    }\n}\n\nlet twigVisual;\n\nTwigVisual.onReady(() => {\n    twigVisual = new TwigVisual();\n});\n"]}